(function(){const $=document.createElement("link").relList;if($&&$.supports&&$.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))u(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const ae of f.addedNodes)ae.tagName==="LINK"&&ae.rel==="modulepreload"&&u(ae)}).observe(document,{childList:!0,subtree:!0});function h(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function u(i){if(i.ep)return;i.ep=!0;const f=h(i);fetch(i.href,f)}})();var Ki=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vi={exports:{}};(function(D,$){(function(h,u){u($)})(Ki,function(h){function u(a,e,t,n){return new(t||(t=Promise))(function(o,r){function s(c){try{l(n.next(c))}catch(g){r(g)}}function d(c){try{l(n.throw(c))}catch(g){r(g)}}function l(c){c.done?o(c.value):function(p){return p instanceof t?p:new t(function(m){m(p)})}(c.value).then(s,d)}l((n=n.apply(a,e||[])).next())})}function i(a,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?a!==e||!n:!e.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(a):n?n.value:e.get(a)}function f(a,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?a!==e||!o:!e.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(a,t):o?o.value=t:e.set(a,t),t}typeof SuppressedError=="function"&&SuppressedError;var ae,Xe;class jt{constructor(e,t){this.instanceName=e,this.level=t}debug(e,...t){if("1">=this.level){const n={from:`${this.instanceName}.${e}`,message:t};console.debug(n)}}info(e,...t){if("2">=this.level){const n={from:`${this.instanceName}.${e}`,message:t};console.info(n)}}warn(e,...t){if("3">=this.level){const n={from:`${this.instanceName}.${e}`,message:t};console.warn(n)}}error(e,...t){const n={from:`${this.instanceName}.${e}`,error:t};console.error(n)}}class T{static getLogger(e){return i(this,ae,"f",Xe).has(e)||i(this,ae,"f",Xe).set(e,new jt(e,"4")),i(this,ae,"f",Xe).get(e)}static setLoggerLevel(e){Object.keys(e).forEach(t=>{ae.getLogger(t).level=e[t]})}}ae=T,Xe={value:new Map};class I{constructor(){this.isFullFilled=!1,this.isPending=!0,this.promise=new Promise((e,t)=>{this.reject=n=>u(this,void 0,void 0,function*(){return this.isFullFilled=!0,this.isPending=!1,t(n)}),this.resolve=n=>u(this,void 0,void 0,function*(){return this.isFullFilled=!0,this.isPending=!1,e(n)})})}}function We(a,e){const t=Math.hypot(e.y-a.y,e.x-a.x);return isNaN(t)?0:t}function F(a,e){return Math.atan2(e.y-a.y,e.x-a.x)}function mt(a,e){return a.x*e.x+a.y*e.y}function Wt(a,e){const t={x:a.x-e.p1.x,y:a.y-e.p1.y},n={x:e.p2.x-e.p1.x,y:e.p2.y-e.p1.y},o=mt(t,n),r=mt(n,n),s=Math.min(1,Math.max(0,o/r));return{x:e.p1.x+n.x*s,y:e.p1.y+n.y*s}}const Ye=(a,e)=>{const t=a.split("."),n=e.split(".");for(let o=0;o<n.length;o++){const r=Number(n[o]),s=Number(t[o]);if(r>s)return!1;if(r<s)return!0}return!0};function vt(a,e,t){return u(this,void 0,void 0,function*(){const n=new TextEncoder,o=n.encode(a),r=n.encode(e+t),s=yield crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign"]),d=yield crypto.subtle.sign("HMAC",s,o),l=new Uint8Array(d);return Array.prototype.map.call(l,c=>c.toString(16).padStart(2,"0")).join("")})}function yt(a){return 96*a/25.4}function xt(){let a=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),(e=="x"?t:3&t|8).toString(16)})}const K=(a,...e)=>{const t=o=>o&&typeof o=="object"&&!Array.isArray(o);if(!e.length)return a;const n=e.shift();if(t(a)&&t(n))for(const o in n)t(n[o])?(a[o]||Object.assign(a,{[o]:{}}),K(a[o],n[o])):Array.isArray(a[o])&&Array.isArray(n[o])?a[o].concat(n[o]):Object.assign(a,{[o]:n[o]});else Array.isArray(a)&&Array.isArray(n)?a=a.concat(n):n&&(a=n);return K(a,...e)};function B(a,e,t){const n=a.p*t;return[{x:a.x-Math.sin(e)*n,y:a.y+Math.cos(e)*n},{x:a.x+Math.sin(e)*n,y:a.y-Math.cos(e)*n}]}function de(a,e){return{x:(e.x+a.x)/2,y:(e.y+a.y)/2,p:(e.p+a.p)/2,t:(e.t+a.t)/2}}const $t={capture:!1,passive:!0},Ht={listenerOptions:$t,xyFloatPrecision:0,timestampFloatPrecision:0},$e={"erase-precisely":!1},Gt={"match-text-size":!0},Ut={convert:Gt,eraser:$e,mimeTypes:["application/vnd.myscript.jiix"]},Ft={"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}},Bt={"image-resolution":300,jiix:Ft},bt={top:20,left:10,right:10,bottom:10},Vt={enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},qt={mode:"stroke"},Jt={solver:Vt,margin:bt,eraser:$e,"undo-redo":qt,mimeTypes:["application/vnd.myscript.jiix"]},Xt={text:!0,shape:!0},Yt={recognition:Xt,eraser:$e},Zt={"draw-text-boxes":!1,"draw-image-boxes":!1},Kt={debug:Zt},Qt={enable:!0},ei={guides:Qt,eraser:$e,margin:bt,mimeTypes:["application/vnd.myscript.jiix"]},ti={force:{"on-stylesheet-change":!1}},ii={diagram:Ut,export:Bt,math:Jt,"raw-content":Yt,renderer:Kt,text:ei,type:"TEXT",alwaysConnected:!0,lang:"en_US",gesture:{enable:!0},convert:ti},ni={enable:!0,gap:50},oi={enable:!0},ri={guides:ni,smartGuide:oi,minHeight:100,minWidth:100},si={protocol:"WEBSOCKET",scheme:"https",host:"cloud.myscript.com",applicationKey:"",hmacKey:"",version:"2.3.0",useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},ai={exportContent:"POINTER_UP",exportContentDelay:1e3,resizeTriggerDelay:100},di={maxStackSize:100};var He;const ke={server:si,recognition:ii,grabber:Ht,rendering:ri,triggers:ai,"undo-redo":di};class wt{constructor(e){He.set(this,T.getLogger("CONFIGURATION")),i(this,He,"f").info("constructor",{configuration:e}),this.grabber=JSON.parse(JSON.stringify(ke.grabber)),this.recognition=JSON.parse(JSON.stringify(ke.recognition)),this.rendering=JSON.parse(JSON.stringify(ke.rendering)),this.server=JSON.parse(JSON.stringify(ke.server)),this.triggers=JSON.parse(JSON.stringify(ke.triggers)),this.overrideDefaultConfiguration(e)}overrideDefaultConfiguration(e){var t,n,o,r,s,d,l;i(this,He,"f").info("overrideDefaultConfiguration",{configuration:e});const c=JSON.parse(JSON.stringify(ke));this.grabber=K({},c.grabber,e==null?void 0:e.grabber),this.recognition=K({},c.recognition,e==null?void 0:e.recognition),this.rendering=K({},c.rendering,e==null?void 0:e.rendering),this.server=K({},c.server,e==null?void 0:e.server),this.triggers=K({},c.triggers,e==null?void 0:e.triggers),this["undo-redo"]=K({},c["undo-redo"],e==null?void 0:e["undo-redo"]),this.recognition.text.mimeTypes=((n=(t=e==null?void 0:e.recognition)===null||t===void 0?void 0:t.text)===null||n===void 0?void 0:n.mimeTypes)||c.recognition.text.mimeTypes,this.recognition.math.mimeTypes=((r=(o=e==null?void 0:e.recognition)===null||o===void 0?void 0:o.math)===null||r===void 0?void 0:r.mimeTypes)||c.recognition.math.mimeTypes,this.recognition.diagram.mimeTypes=((d=(s=e==null?void 0:e.recognition)===null||s===void 0?void 0:s.diagram)===null||d===void 0?void 0:d.mimeTypes)||c.recognition.diagram.mimeTypes,!((l=this.server)===null||l===void 0)&&l.useWindowLocation&&(this.server.scheme=window.location.protocol.indexOf("s")>-1?"https":"http",this.server.host=window.location.host),this.server.protocol==="REST"&&this.triggers.exportContent==="POINTER_UP"&&(this.triggers.exportContent="QUIET_PERIOD",this.triggers.exportContentDelay=Math.max(this.triggers.exportContentDelay,50)),this.server.protocol==="WEBSOCKET"&&this.recognition.type==="TEXT"?this.rendering.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix"):this.rendering.smartGuide.enable=!1,i(this,He,"f").debug("overrideDefaultConfiguration",{configuration:this})}}He=new WeakMap;const Et={EDITOR:"4",BEHAVIORS:"4",RECOGNIZER:"4",GRABBER:"4",RENDERER:"4",CONFIGURATION:"4",PUBLIC_EVENT:"4",INTERNAL_EVENT:"4",MODEL:"4",STROKE:"4",SMARTGUIDE:"4",STYLE:"4",UNDO_REDO:"4"},L={NO_ACTIVITY:"Session closed due to no activity.",WRONG_CREDENTIALS:"Application credentials are invalid. Please check or regenerate your application key and hmackey.",TOO_OLD:"Session is too old. Max Session Duration Reached.",UNKNOW:"An unknown error has occurred.",ABNORMAL_CLOSURE:"MyScript recognition server is not reachable.",CANT_ESTABLISH:"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.",GOING_AWAY:"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.",PROTOCOL_ERROR:"MyScript recognition server terminated the connection due to a protocol error.",UNSUPPORTED_DATA:"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)",INVALID_FRAME_PAULOAD:"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).",POLICY_VIOLATION:"MyScript recognition server terminated the connection because it received a message that violates its policy.",MESSAGE_TOO_BIG:"MyScript recognition server terminated the connection because a data frame was received that is too large.",INTERNAL_ERROR:"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.",SERVICE_RESTART:"MyScript recognition server terminated the connection because it is restarting.",TRY_AGAIN:"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.",BAD_GATEWAY:"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.",TLS_HANDSHAKE:"MyScript recognition server connection was closed due to a failure to perform a TLS handshake"},ve={CHANGED:"changed",CLEARED:"cleared",CONVERTED:"converted",ERROR:"error",POINTEREVENTS:"pointer_events",EXPORTED:"exported",IMPORTED:"imported",IDLE:"idle",LOADED:"loaded"},k={SVG_PATCH:"internal_svg_patch",EXPORTED:"internal_exported",CLEAR_MESSAGE:"internal_clear_message",ERROR:"internal_error",NOTIF:"internal_notif",IMPORT_JIIX:"internal_import_jiix",CONVERT:"internal_convert",CLEAR:"internal_clear",CONTEXT_CHANGE:"internal_context_change",IDLE:"internal_idle",WS_CLOSED:"internal_websocket_closed"};var Ne,hi,Ze,V,q,ye,Ke,z,S,Q,he,xe,Qe,et,oe,be,re;h.ExportType=void 0,(Ne=h.ExportType||(h.ExportType={})).JIIX="application/vnd.myscript.jiix",Ne.TEXT="text/plain",Ne.LATEX="application/x-latex",Ne.MATHML="application/mathml+xml",Ne.SVG="image/svg+xml",Ne.OFFICE_DOCUMENT="application/vnd.openxmlformats-officedocument.presentationml.presentation",h.Intention=void 0,(hi=h.Intention||(h.Intention={})).Write="write",hi.Erase="erase",h.LoggerLevel=void 0,(Ze=h.LoggerLevel||(h.LoggerLevel={})).DEBUG="1",Ze.INFO="2",Ze.WARN="3",Ze.ERROR="4",h.LoggerClass=void 0,(V=h.LoggerClass||(h.LoggerClass={})).EDITOR="EDITOR",V.RECOGNIZER="RECOGNIZER",V.GRABBER="GRABBER",V.BEHAVIORS="BEHAVIORS",V.CONFIGURATION="CONFIGURATION",V.PUBLIC_EVENT="PUBLIC_EVENT",V.MODEL="MODEL",V.RENDERER="RENDERER",V.SMARTGUIDE="SMARTGUIDE",V.STYLE="STYLE",V.UNDO_REDO="UNDO_REDO",V.STROKE="STROKE",V.INTERNAL_EVENT="INTERNAL_EVENT";class we extends EventTarget{constructor(){super(),q.add(this),z.set(this,void 0),S.set(this,T.getLogger("INTERNAL_EVENT")),i(this,S,"f").info("constructor"),f(this,z,new AbortController,"f")}static getInstance(){return i(ye,ye,"f",Ke)||f(ye,ye,new ye,"f",Ke),i(ye,ye,"f",Ke)}removeAllListeners(){i(this,S,"f").info("removeAllListeners"),i(this,z,"f").abort(),f(this,z,new AbortController,"f")}emitSVGPatch(e){i(this,S,"f").info("emitSVGPatch",{patchChange:e}),i(this,q,"m",Q).call(this,k.SVG_PATCH,e)}addSVGPatchListener(e){i(this,S,"f").info("addSVGPatchListener",{callback:e}),this.addEventListener(k.SVG_PATCH,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitExported(e){i(this,S,"f").info("emitExported",{exports:e}),i(this,q,"m",Q).call(this,k.EXPORTED,e)}addExportedListener(e){i(this,S,"f").info("addExportedListener",{callback:e}),this.addEventListener(k.EXPORTED,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitClearMessage(){i(this,S,"f").info("emitClearMessage"),i(this,q,"m",Q).call(this,k.CLEAR_MESSAGE)}addClearMessageListener(e){i(this,S,"f").info("addClearMessageListener",{callback:e}),this.addEventListener(k.CLEAR_MESSAGE,()=>e(),{signal:i(this,z,"f").signal})}emitError(e){i(this,S,"f").info("emitError",{err:e}),i(this,q,"m",Q).call(this,k.ERROR,e)}addErrorListener(e){i(this,S,"f").info("addErrorListener",{callback:e}),this.addEventListener(k.ERROR,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitWSClosed(){i(this,S,"f").info("emitWSClosed"),i(this,q,"m",Q).call(this,k.WS_CLOSED)}addWSClosedListener(e){i(this,S,"f").info("addWSClosedListener",{callback:e}),this.addEventListener(k.WS_CLOSED,()=>e(),{signal:i(this,z,"f").signal})}emitNotif(e){i(this,S,"f").info("emitWNotif",{notif:e}),i(this,q,"m",Q).call(this,k.NOTIF,e)}addNotifListener(e){i(this,S,"f").info("addNotifListener",{callback:e}),this.addEventListener(k.NOTIF,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitImportJIIX(e){i(this,S,"f").info("emitImportJIIX",{jiix:e}),i(this,q,"m",Q).call(this,k.IMPORT_JIIX,e)}addImportJIIXListener(e){i(this,S,"f").info("addImportJIIXListener",{callback:e}),this.addEventListener(k.IMPORT_JIIX,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitConvert(e="DIGITAL_EDIT"){i(this,S,"f").info("emitConvert",{conversionState:e}),i(this,q,"m",Q).call(this,k.CONVERT,e)}addConvertListener(e){i(this,S,"f").info("addConvertListener",{callback:e}),this.addEventListener(k.CONVERT,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitClear(){i(this,S,"f").info("emitClear"),i(this,q,"m",Q).call(this,k.CLEAR)}addClearListener(e){i(this,S,"f").info("addClearListener",{callback:e}),this.addEventListener(k.CLEAR,()=>e(),{signal:i(this,z,"f").signal})}emitContextChange(e){i(this,S,"f").info("emitContextChange",{context:e}),i(this,q,"m",Q).call(this,k.CONTEXT_CHANGE,e)}addContextChangeListener(e){i(this,S,"f").info("addContextChangeListener",{callback:e}),this.addEventListener(k.CONTEXT_CHANGE,t=>e(t.detail),{signal:i(this,z,"f").signal})}emitIdle(e){i(this,S,"f").info("emitIdle",{idle:e}),i(this,q,"m",Q).call(this,k.IDLE,e)}addIdleListener(e){i(this,S,"f").info("addIdleListener",{callback:e}),this.addEventListener(k.IDLE,t=>e(t.detail),{signal:i(this,z,"f").signal})}}ye=we,z=new WeakMap,S=new WeakMap,q=new WeakSet,Q=function(e,t){this.dispatchEvent(new CustomEvent(e,Object.assign({bubbles:!0,composed:!0},t?{detail:t}:void 0)))},Ke={value:void 0};class St extends EventTarget{constructor(){super(),he.add(this),et.set(this,void 0),oe.set(this,T.getLogger("PUBLIC_EVENT"))}static getInstance(){return i(xe,xe,"f",Qe)||f(xe,xe,new xe,"f",Qe),i(xe,xe,"f",Qe)}setElement(e){i(this,oe,"f").info("setElement",{el:e}),f(this,et,e,"f")}emitLoaded(){i(this,oe,"f").info("emitLoaded"),i(this,he,"m",be).call(this,ve.LOADED)}emitExported(e){i(this,oe,"f").info("emitExported",{exports:e}),i(this,he,"m",be).call(this,ve.EXPORTED,e)}emitChanged(e){i(this,oe,"f").info("emitChanged",{undoRedoContext:e}),i(this,he,"m",be).call(this,ve.CHANGED,Object.assign(Object.assign({},e),{canClear:!e.empty}))}emitIdle(e){i(this,oe,"f").info("emitIdle",{idle:e}),i(this,he,"m",be).call(this,ve.IDLE,e)}emitCleared(e){i(this,oe,"f").info("emitCleared",{model:e}),i(this,he,"m",be).call(this,ve.CLEARED,e)}emitConverted(e){i(this,oe,"f").info("emitConverted",{exports:e}),i(this,he,"m",be).call(this,ve.CONVERTED,e)}emitImported(e){i(this,oe,"f").info("emitImported",{exports:e}),i(this,he,"m",be).call(this,ve.IMPORTED,e)}}xe=St,et=new WeakMap,oe=new WeakMap,he=new WeakSet,be=function(e,t){var n;const o=new CustomEvent(e,Object.assign({bubbles:!0,composed:!0},t?{detail:t}:void 0));this.dispatchEvent(o),(n=i(this,et,"f"))===null||n===void 0||n.dispatchEvent(o)},Qe={value:void 0};class Ct{constructor(e){this.prevent=t=>t.preventDefault(),re.set(this,T.getLogger("GRABBER")),this.pointerDownHandler=t=>{if(i(this,re,"f").info("pointerDown",{evt:t}),t.button===0&&t.buttons===1&&(this.activePointerId=t.pointerId,this.onPointerDown)){const n=this.extractPoint(t);this.onPointerDown(t,n)}},this.pointerMoveHandler=t=>{if(i(this,re,"f").info("pointerMove",{evt:t}),this.activePointerId!=null&&this.activePointerId===t.pointerId){if(t.target.classList.contains("smartguide"))return void this.pointerUpHandler(t);if(this.onPointerMove){const n=this.extractPoint(t);this.onPointerMove(t,n)}}},this.pointerUpHandler=t=>{if(i(this,re,"f").info("pointerUp",{evt:t}),this.activePointerId!=null&&this.activePointerId===t.pointerId&&(this.activePointerId=void 0,t.stopPropagation(),this.onPointerUp)){const n=this.extractPoint(t);this.onPointerUp(t,n)}},this.pointerOutHandler=t=>{if(this.activePointerId!=null&&this.activePointerId===t.pointerId&&!this.domElement.contains(t.target)&&(t.stopPropagation(),this.activePointerId=void 0,this.onPointerUp)){const n=this.extractPoint(t);this.onPointerUp(t,n)}},i(this,re,"f").info("constructor",{configuration:e}),this.configuration=e}roundFloat(e,t){if(t>=0){const n=Math.pow(10,t);return Math.round(e/n)*n}return i(this,re,"f").debug("roundFloat",{oneFloat:e,requestedFloatPrecision:t}),e}extractPoint(e){let t,n;({clientX:t,clientY:n}="changedTouches"in e?e.changedTouches[0]:e);const o=this.domElement.getBoundingClientRect(),r={x:this.roundFloat(t-o.left-this.domElement.clientLeft+this.domElement.scrollLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(n-o.top-this.domElement.clientTop+this.domElement.scrollTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:e.pressure||1};return i(this,re,"f").debug("extractPoint",{event:e,pointer:r}),r}attach(e){i(this,re,"f").info("attach",{domElement:e}),this.domElement&&this.detach(),this.domElement=e,this.domElement.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerout",this.pointerOutHandler,this.configuration.listenerOptions),this.domElement.addEventListener("touchmove",this.prevent),document.documentElement.addEventListener("pointerdown",()=>{})}detach(){var e,t,n,o,r,s,d;i(this,re,"f").info("detach"),(e=this.domElement)===null||e===void 0||e.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),(t=this.domElement)===null||t===void 0||t.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),(n=this.domElement)===null||n===void 0||n.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),(o=this.domElement)===null||o===void 0||o.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),(r=this.domElement)===null||r===void 0||r.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),(s=this.domElement)===null||s===void 0||s.removeEventListener("pointerout",this.pointerOutHandler,this.configuration.listenerOptions),(d=this.domElement)===null||d===void 0||d.removeEventListener("touchmove",this.prevent),document.documentElement.removeEventListener("pointerdown",()=>{})}}re=new WeakMap;const Ge={},li={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};var ci=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(a,e){a.exports=function(t){function n(r){if(o[r])return o[r].exports;var s=o[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var o={};return n.m=t,n.c=o,n.i=function(r){return r},n.d=function(r,s,d){n.o(r,s)||Object.defineProperty(r,s,{configurable:!1,enumerable:!0,get:d})},n.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(s,"a",s),s},n.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},n.p="",n(n.s=1)}([function(t,n,o){function r(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},d=function l(c){var g=this;r(this,l),this.toJSON=function(p){if(typeof p!="string")return console.error("Need a CSS string but given ",p===void 0?"undefined":s(p),p),"Not a valid CSS..!";var m={},v=void 0,C=void 0,P=void 0;try{p.split("{").forEach(function(Y){if(C=Y.trim())if(C.indexOf("}")===-1)m[C]={},v=C;else{C.substring(0,C.indexOf("}")).split(";").forEach(function(Z){(P=Z.split(":"))&&P.length===2&&(m[v][P[0].trim().replace(/^\"|\"$/g,"")]=g._trimSemiColon(P[1].trim().replace(/^\"|\"$/g,"")))});try{(v=C.split("}")[1].trim())&&(m[v]={})}catch{}}})}catch{return"Not a valid CSS..!"}return m},this.toCSS=function(p){if((p===void 0?"undefined":s(p))!=="object")return console.error("Need a JSON object but given ",p===void 0?"undefined":s(p),p),"Not a valid JSON..!";var m="";try{for(var v in p)if(p.hasOwnProperty(v)){for(var C in m+=v+` {
`,p[v])p[v].hasOwnProperty(C)&&(m+=C+": "+p[v][C]+`;
`);m+=`}
`}}catch{return"Not a valid JSON..!"}return m},this._trimSemiColon=function(p){return p.slice(-1)===";"?p.slice(0,g.length-1):p}};n.default=d},function(t,n,o){t.exports=o(0).default}])}),Zi=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(ci);ci.JsonCSS;const Ue=new Zi,tt={themeToCSS:a=>Ue.toCSS(a),themeToJSON(a){const e=Ue.toJSON(a);return e[".text"]["font-size"]=Number(e[".text"]["font-size"]),e.ink["-myscript-pen-width"]=Number(e.ink["-myscript-pen-width"]),e.ink.width=Number(e.ink.width),e},penStyleToCSS(a){let e=Ue.toCSS({css:a});return e=e.substring(6,e.length-3),e},penStyleToJSON(a){const e=Ue.toJSON(`css {${a}}`).css;return e.width?e.width=Number(e.width):delete e.width,e["-myscript-pen-width"]?e["-myscript-pen-width"]=Number(e["-myscript-pen-width"]):delete e["-myscript-pen-width"],e},stringToJSON:a=>Ue.toJSON(`css {${a}}`).css,JSONToString:a=>Object.entries(a).map(([e,t])=>`${e}:${t}`).join(";")};var Fe,Be,Oe,Me,le,kt,Mt,b,A,y,J,Ee,ce,ee,te,ie,w,H,M,it,nt,x,G,ue,ot,E,se,X,pe,N,ne,Te,O,U,fe,ge,me,ze,R,ui,pi,fi,gi,mi,vi,yi,xi,bi,wi,Ei,Tt,rt,Si,Le,st,at,Ci,ki,dt,ht,lt,ct,ut,pt,Mi,Ti,_,Se,j,Pe,De,W,Ve,ft,Li,Pi,gt,Lt,Di,Ii,Pt,Dt,Ai,Ri;class It{constructor(e,t){Fe.set(this,void 0),Be.set(this,void 0),Oe.set(this,void 0),Me.set(this,void 0),le.set(this,T.getLogger("STYLE")),i(this,le,"f").info("constructor",{penStyle:e,theme:t}),this.setTheme(t),this.setPenStyleClasses(),this.setPenStyle(e)}get currentPenStyle(){return i(this,Me,"f")||i(this,Fe,"f")}get penStyle(){return i(this,Fe,"f")}setPenStyle(e){i(this,le,"f").info("setPenStyle",{style:e}),f(this,Fe,K(structuredClone(Ge),e||{}),"f"),f(this,Me,e||this.theme[`.${i(this,Oe,"f")}`],"f"),i(this,le,"f").debug("setPenStyle",i(this,Me,"f"))}get theme(){return i(this,Be,"f")}setTheme(e){i(this,le,"f").info("setTheme",{theme:e}),f(this,Be,K(structuredClone(li),e||{}),"f"),i(this,le,"f").debug("setTheme",i(this,Be,"f"))}get penStyleClasses(){return i(this,Oe,"f")}setPenStyleClasses(e=""){i(this,le,"f").info("setPenStyleClasses",{penStyleClass:e}),f(this,Oe,e,"f"),f(this,Me,this.theme[`.${i(this,Oe,"f")}`],"f"),i(this,le,"f").debug("setPenStyleClasses",i(this,Me,"f"))}}Fe=new WeakMap,Be=new WeakMap,Oe=new WeakMap,Me=new WeakMap,le=new WeakMap,h.SymbolType=void 0,(kt=h.SymbolType||(h.SymbolType={})).Stroke="stroke",kt.Shape="shape",kt.Text="text";class Ni{constructor(e,t){this.creationTime=Date.now(),this.id=`${e}-${xt()}`,this.modificationDate=this.creationTime,this.type=e,this.style=t}}class Ie extends Ni{constructor(e,t,n="pen"){super("stroke",e),Mt.set(this,T.getLogger("STROKE")),i(this,Mt,"f").info("constructor",{style:e,pointerId:t,pointerType:n}),this.style=e,this.pointerId=t,this.pointerType=n,this.pointers=[],this.length=0}getClone(){const e=new Ie(this.style,this.pointerId,this.pointerType);return e.id=this.id,e.creationTime=this.creationTime,e.modificationDate=this.modificationDate,e.pointers=structuredClone(this.pointers),e.length=this.length,e}formatToSend(){const e={id:this.id,pointerType:this.pointerType,p:[],t:[],x:[],y:[]};return this.pointers.forEach(t=>{e.p.push(t.p),e.t.push(t.t),e.x.push(t.x),e.y.push(t.y)}),e}}Mt=new WeakMap;class qe{constructor(e=100,t=100,n=0,o=Date.now()){b.set(this,T.getLogger("MODEL")),i(this,b,"f").info("constructor",{width:e,height:t,creationDate:o}),this.creationTime=o,this.modificationDate=o,this.width=e,this.height=t,this.rowHeight=n,this.symbols=[],this.positions={lastSentPosition:0,lastReceivedPosition:0},this.idle=!0}computePressure(e,t){let n=1;e===t?n=1:e<10?n=.2+Math.pow(.1*e,.4):e>t-10&&(n=.2+Math.pow(.1*(t-e),.4));const o=n*Math.max(.1,1-.1*Math.sqrt(e));return isNaN(o)?.5:Math.round(100*o)/100}filterPointByAcquisitionDelta(e,t,n){const o=2+(e.style["-myscript-pen-width"]||0)/4;return!n||e.pointers.length===0||Math.abs(n.x-t.x)>=o||Math.abs(n.y-t.y)>=o}getStrokeFromPoint(e){i(this,b,"f").info("getStrokeFromPoint",{point:e});const t=(o,r,s)=>o>=r&&o<=s,n=[];return this.symbols.forEach(o=>{for(let r=0;r<o.pointers.length;r++){const s=o.pointers[r];if(t(s.x,e.x-5,e.x+5)&&t(s.y,e.y-5,e.y+5)){n.push(o);break}if(We(e,s)<10){n.push(o);break}}}),i(this,b,"f").debug("getStrokeFromPoint",{strokes:n}),n}addPoint(e,t){i(this,b,"f").debug("addPoint",{stroke:e,pointer:t});const n=e.pointers.at(-1);if(this.filterPointByAcquisitionDelta(e,t,n)){const o=n?We(t,n):0;e.length+=o,t.p=this.computePressure(o,e.length),e.pointers.push(t),e.modificationDate=Date.now()}}addStroke(e){i(this,b,"f").info("addStroke",{stroke:e}),this.symbols.push(e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0}updateStroke(e){i(this,b,"f").info("updateStroke",{updatedStroke:e});const t=this.symbols.findIndex(n=>n.id===e.id);t!==-1&&(e.modificationDate=Date.now(),this.symbols.splice(t,1,e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),i(this,b,"f").debug("updateStroke",this.symbols)}removeStroke(e){i(this,b,"f").info("removeStroke",{id:e});const t=this.symbols.findIndex(n=>n.id===e);t!==-1&&(this.positions.lastSentPosition--,this.positions.lastReceivedPosition--,this.symbols.splice(t,1),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),i(this,b,"f").debug("removeStroke",this.symbols)}removeStrokesFromPoint(e){i(this,b,"f").info("removeStrokesFromPoint",{point:e});const t=this.getStrokeFromPoint(e);return t.forEach(n=>{this.removeStroke(n.id)}),i(this,b,"f").debug("removeStrokesFromPoint",t.map(n=>n.id)),t.map(n=>n.id)}extractUnsentStrokes(){return this.symbols.slice(this.positions.lastSentPosition)}initCurrentStroke(e,t,n,o,r=96){if(i(this,b,"f").info("initCurrentStroke",{point:e,pointerId:t,pointerType:n,style:o,dpi:r}),o["-myscript-pen-width"]){const s=o["-myscript-pen-width"]*r/25.4;o.width=s/2}this.modificationDate=Date.now(),this.exports=void 0,this.currentSymbol=new Ie(o,t,n),i(this,b,"f").debug("initCurrentStroke",this.currentSymbol),this.addPoint(this.currentSymbol,e)}appendToCurrentStroke(e){i(this,b,"f").info("appendToCurrentStroke",{point:e}),this.currentSymbol&&this.addPoint(this.currentSymbol,e),i(this,b,"f").debug("appendToCurrentStroke",this.currentSymbol)}endCurrentStroke(e){i(this,b,"f").info("endCurrentStroke",{point:e}),this.currentSymbol&&(this.addPoint(this.currentSymbol,e),this.addStroke(this.currentSymbol),this.currentSymbol=void 0),i(this,b,"f").debug("endCurrentStroke",this.currentSymbol)}updatePositionSent(e=this.symbols.length){i(this,b,"f").info("updatePositionSent",{position:e}),this.positions.lastSentPosition=e,i(this,b,"f").debug("updatePositionSent",this.positions.lastSentPosition)}updatePositionReceived(){i(this,b,"f").info("updatePositionReceived"),this.positions.lastReceivedPosition=this.positions.lastSentPosition,i(this,b,"f").debug("updatePositionReceived",this.positions.lastReceivedPosition)}mergeExport(e){i(this,b,"f").info("mergeExport",{exports:e}),this.exports?Object.assign(this.exports,e):this.exports=e,i(this,b,"f").debug("mergeExport",this.exports)}mergeConvert(e){i(this,b,"f").info("mergeConvert",{converts:e}),this.converts?Object.assign(this.converts,e):this.converts=e,i(this,b,"f").debug("mergeConvert",this.converts)}getClone(){i(this,b,"f").info("getClone");const e=new qe(this.width,this.height,this.rowHeight,this.creationTime);return e.modificationDate=JSON.parse(JSON.stringify(this.modificationDate)),e.currentSymbol=this.currentSymbol?this.currentSymbol.getClone():void 0,e.symbols=this.symbols.map(t=>t.getClone()),e.positions=JSON.parse(JSON.stringify(this.positions)),e.exports=this.exports?JSON.parse(JSON.stringify(this.exports)):void 0,e.converts=this.converts?JSON.parse(JSON.stringify(this.converts)):void 0,e.idle=this.idle,i(this,b,"f").debug("getClone",{clonedModel:e}),e}clear(){i(this,b,"f").info("clear"),this.modificationDate=Date.now(),this.currentSymbol=void 0,this.symbols=[],this.positions.lastSentPosition=0,this.positions.lastReceivedPosition=0,this.exports=void 0,this.converts=void 0,this.idle=!0}}b=new WeakMap;class Oi{constructor(e,t){A.set(this,T.getLogger("RECOGNIZER")),i(this,A,"f").info("constructor",{serverConfig:e,recognitionConfig:t}),this.serverConfiguration=e,this.recognitionConfiguration=t}get url(){return`${this.serverConfiguration.scheme}://${this.serverConfiguration.host}/api/v4.0/iink/batch`}get postConfig(){switch(this.recognitionConfiguration.type){case"DIAGRAM":return{lang:this.recognitionConfiguration.lang,diagram:this.recognitionConfiguration.diagram,export:this.recognitionConfiguration.export};case"MATH":return{lang:this.recognitionConfiguration.lang,math:this.recognitionConfiguration.math,export:this.recognitionConfiguration.export};case"Raw Content":return{lang:this.recognitionConfiguration.lang,"raw-content":this.recognitionConfiguration["raw-content"],export:this.recognitionConfiguration.export};case"TEXT":return{lang:this.recognitionConfiguration.lang,text:this.recognitionConfiguration.text,export:this.recognitionConfiguration.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.recognitionConfiguration.type}"`)}}buildData(e){i(this,A,"f").info("buildData",{model:e});const t=[];e.symbols.forEach(s=>{const d=t.findIndex(l=>{return c=l.penStyle,g=s.style,c&&g&&c["-myscript-pen-fill-color"]===g["-myscript-pen-fill-color"]&&c["-myscript-pen-fill-style"]===g["-myscript-pen-fill-style"]&&c["-myscript-pen-width"]===g["-myscript-pen-width"]&&c.color===g.color&&c.width===g.width;var c,g});d>-1?t[d].strokes.push(s):t.push({penStyle:s.style,strokes:[s]})});const n=[];t.forEach(s=>{const d={penStyle:JSON.stringify(s.penStyle)==="{}"?void 0:tt.penStyleToCSS(s.penStyle),strokes:s.strokes.map(l=>l.formatToSend())};n.push(d)});const o=this.recognitionConfiguration.type==="Raw Content"?"Raw Content":this.recognitionConfiguration.type.charAt(0).toUpperCase()+this.recognitionConfiguration.type.slice(1).toLowerCase(),r={configuration:this.postConfig,xDPI:96,yDPI:96,contentType:o,height:e.height,width:e.width,strokeGroups:n};return i(this,A,"f").debug("buildData",{data:r}),r}post(e,t){return u(this,void 0,void 0,function*(){i(this,A,"f").info("post",{data:e,mimeType:t});const n=new Headers;n.append("Accept","application/json,"+t),n.append("applicationKey",this.serverConfiguration.applicationKey);try{const d=yield vt(JSON.stringify(e),this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey);n.append("hmac",d)}catch(d){i(this,A,"f").error("post.computeHmac",d)}n.append("Content-Type","application/json"),Ye(this.serverConfiguration.version,"2.0.4")&&(n.append("myscript-client-name","iink-ts"),n.append("myscript-client-version","1.0.5"));const o={method:"POST",headers:n,body:JSON.stringify(e)},r=new Request(this.url,o),s=yield fetch(r);if(s.ok){let d;switch(s.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":d=yield s.blob();break;case"application/json":d=yield s.json();break;case"application/vnd.myscript.jiix":d=yield s.clone().json().catch(()=>u(this,void 0,void 0,function*(){return yield s.text()}));break;default:d=yield s.text()}return i(this,A,"f").debug("post",{result:d}),d}{const d=yield s.json();throw i(this,A,"f").error("post",{err:d}),d}})}tryFetch(e,t){return u(this,void 0,void 0,function*(){return i(this,A,"f").debug("tryFetch",{data:e,mimeType:t}),this.post(e,t).then(n=>{const o={};return o[t]=n,i(this,A,"f").debug("tryFetch",{exports:o}),o}).catch(n=>{i(this,A,"f").error("tryFetch",{data:e,mimeType:t,err:n});let o=n.message||L.UNKNOW;throw n.code?n.code==="access.not.granted"&&(o=L.WRONG_CREDENTIALS):o=L.CANT_ESTABLISH,new Error(o)})})}getMimeTypes(e){i(this,A,"f").info("getMimeTypes",{requestedMimeTypes:e});let t=e||[];if(!t.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":t=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":t=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":t=["application/vnd.myscript.jiix"];break;case"TEXT":t=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.
 Possible types are:
 -DIAGRAM
 -MATH
 -Raw Content
 -TEXT`)}return t}convert(e,t,n){return u(this,void 0,void 0,function*(){i(this,A,"f").info("convert",{model:e,conversionState:t,requestedMimeTypes:n});const o=e.getClone(),r=this.getMimeTypes(n),s=this.buildData(o);s.conversionState=t;const d=r.map(l=>this.tryFetch(s,l));return(yield Promise.all(d)).forEach(l=>{o.mergeConvert(l)}),i(this,A,"f").debug("convert",{model:o}),o})}export(e,t){return u(this,void 0,void 0,function*(){i(this,A,"f").info("export",{model:e,requestedMimeTypes:t});const n=e.getClone();if(n.symbols.length===0)return Promise.resolve(n);const o=this.getMimeTypes(t);if(!o.length)return i(this,A,"f").error("export",{model:e,requestedMimeTypes:t,"Export failed, no mimeTypes define in recognition configuration":String}),Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const r=o.filter(d=>!n.exports||!n.exports[d]),s=this.buildData(e);return(yield Promise.all(r.map(d=>this.tryFetch(s,d)))).forEach(d=>{n.mergeExport(d)}),i(this,A,"f").debug("export",{model:n}),n})}resize(e){return u(this,void 0,void 0,function*(){return i(this,A,"f").info("resize",{model:e}),this.export(e)})}}A=new WeakMap;class zi{constructor(e,t){y.set(this,T.getLogger("RECOGNIZER")),this.pingCount=0,this.reconnectionCount=0,this.serverConfiguration=e,this.recognitionConfiguration=t;const n=this.serverConfiguration.scheme==="https"?"wss":"ws";this.url=`${n}://${this.serverConfiguration.host}/api/v4.0/iink/document?applicationKey=${this.serverConfiguration.applicationKey}`,i(this,y,"f").info("constructor",{serverConfig:e,recognitionConfig:t,url:this.url})}get mimeTypes(){switch(this.recognitionConfiguration.type.toLocaleLowerCase()){case"text":return this.recognitionConfiguration.text.mimeTypes;case"math":return this.recognitionConfiguration.math.mimeTypes;default:throw new Error(`Unauthorized recognition type: "${this.recognitionConfiguration.type}"`)}}get internalEvent(){return we.getInstance()}infinitePing(){this.pingCount++,this.serverConfiguration.websocket.maxPingLostCount<this.pingCount?this.socket.close(1e3,"PING_LOST"):this.socket.readyState<=1&&setTimeout(()=>{this.socket.readyState<=1&&(this.socket.send(JSON.stringify({type:"ping"})),this.infinitePing())},this.serverConfiguration.websocket.pingDelay)}openCallback(){var e;(e=this.connected)===null||e===void 0||e.resolve();const t={type:this.sessionId?"restoreIInkSession":"newContentPackage",iinkSessionId:this.sessionId,applicationKey:this.serverConfiguration.applicationKey,xDpi:96,yDpi:96,viewSizeHeight:this.viewSizeHeight,viewSizeWidth:this.viewSizeWidth};Ye(this.serverConfiguration.version,"2.0.4")&&(t["myscript-client-name"]="iink-ts",t["myscript-client-version"]="1.0.5"),this.send(t)}rejectDeferredPending(e){var t,n,o,r,s,d,l,c,g,p,m,v,C,P,Y,Z,_e,je,Ae,Re;!((t=this.connected)===null||t===void 0)&&t.isPending&&((n=this.connected)===null||n===void 0||n.reject(e)),!((o=this.initialized)===null||o===void 0)&&o.isPending&&((r=this.initialized)===null||r===void 0||r.reject(e)),!((s=this.addStrokeDeferred)===null||s===void 0)&&s.isPending&&((d=this.addStrokeDeferred)===null||d===void 0||d.reject(e)),!((l=this.exportDeferred)===null||l===void 0)&&l.isPending&&((c=this.exportDeferred)===null||c===void 0||c.reject(e)),!((g=this.convertDeferred)===null||g===void 0)&&g.isPending&&((p=this.convertDeferred)===null||p===void 0||p.reject(e)),!((m=this.importDeferred)===null||m===void 0)&&m.isPending&&((v=this.importDeferred)===null||v===void 0||v.reject(e)),!((C=this.resizeDeferred)===null||C===void 0)&&C.isPending&&((P=this.resizeDeferred)===null||P===void 0||P.reject(e)),!((Y=this.undoDeferred)===null||Y===void 0)&&Y.isPending&&((Z=this.undoDeferred)===null||Z===void 0||Z.reject(e)),!((_e=this.redoDeferred)===null||_e===void 0)&&_e.isPending&&((je=this.redoDeferred)===null||je===void 0||je.reject(e)),!((Ae=this.clearDeferred)===null||Ae===void 0)&&Ae.isPending&&this.clearDeferred.reject(e),!((Re=this.waitForIdleDeferred)===null||Re===void 0)&&Re.isPending&&this.waitForIdleDeferred.reject(e)}closeCallback(e){let t="";if(!this.currentErrorCode)switch(e.code){case 1e3:break;case 1001:t=L.GOING_AWAY;break;case 1002:t=L.PROTOCOL_ERROR;break;case 1003:t=L.UNSUPPORTED_DATA;break;case 1006:t=L.ABNORMAL_CLOSURE;break;case 1007:t=L.INVALID_FRAME_PAULOAD;break;case 1008:t=L.POLICY_VIOLATION;break;case 1009:t=L.MESSAGE_TOO_BIG;break;case 1011:t=L.INTERNAL_ERROR;break;case 1012:t=L.SERVICE_RESTART;break;case 1013:t=L.TRY_AGAIN;break;case 1014:t=L.BAD_GATEWAY;break;case 1015:t=L.TLS_HANDSHAKE;break;default:i(this,y,"f").warn("closeCallback","unknow CloseEvent.code",{evt:e}),t=L.CANT_ESTABLISH}const n=new Error(t||e.reason);this.rejectDeferredPending(n),this.currentErrorCode||e.code===1e3||this.internalEvent.emitError(n)}manageAckMessage(e){var t;return u(this,void 0,void 0,function*(){i(this,y,"f").info("manageAckMessage",{websocketMessage:e});const n=e;n.hmacChallenge&&this.send({type:"hmac",hmac:yield vt(n.hmacChallenge,this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)}),n.iinkSessionId&&(this.sessionId=n.iinkSessionId);const o=structuredClone(this.recognitionConfiguration);Ye(this.serverConfiguration.version,"2.3.0")||delete o.convert,this.send(Object.assign(Object.assign({},o),{type:"configuration"})),(t=this.ackDeferred)===null||t===void 0||t.resolve()})}manageContentPackageDescriptionMessage(){var e;return u(this,void 0,void 0,function*(){this.reconnectionCount=0,yield(e=this.ackDeferred)===null||e===void 0?void 0:e.promise,i(this,y,"f").info("manageContentPackageDescriptionMessage"),this.currentPartId?this.send({type:"openContentPart",id:this.currentPartId,mimeTypes:this.mimeTypes}):this.send({type:"newContentPart",contentType:this.recognitionConfiguration.type,mimeTypes:this.mimeTypes})})}managePartChangeMessage(e){var t;i(this,y,"f").info("managePartChangeMessage",{websocketMessage:e});const n=e;this.currentPartId=n.partId,(t=this.initialized)===null||t===void 0||t.resolve()}manageExportMessage(e){var t,n,o,r,s,d,l,c,g;i(this,y,"f").info("manageExportMessage",{websocketMessage:e});const p=e;p.exports["application/vnd.myscript.jiix"]&&(p.exports["application/vnd.myscript.jiix"]=JSON.parse(p.exports["application/vnd.myscript.jiix"].toString())),(t=this.initialized)===null||t===void 0||t.resolve(),(n=this.addStrokeDeferred)===null||n===void 0||n.resolve(p.exports),(o=this.exportDeferred)===null||o===void 0||o.resolve(p.exports),(r=this.convertDeferred)===null||r===void 0||r.resolve(p.exports),(s=this.importDeferred)===null||s===void 0||s.resolve(p.exports),(d=this.undoDeferred)===null||d===void 0||d.resolve(p.exports),(l=this.redoDeferred)===null||l===void 0||l.resolve(p.exports),(c=this.clearDeferred)===null||c===void 0||c.resolve(p.exports),(g=this.importPointEventsDeferred)===null||g===void 0||g.resolve(p.exports),this.internalEvent.emitExported(p.exports)}manageWaitForIdle(){var e;return u(this,void 0,void 0,function*(){this.internalEvent.emitIdle(!0),(e=this.waitForIdleDeferred)===null||e===void 0||e.resolve()})}manageErrorMessage(e){var t,n;const o=e;this.currentErrorCode=((t=o.data)===null||t===void 0?void 0:t.code)||o.code;let r=((n=o.data)===null||n===void 0?void 0:n.message)||o.message||L.UNKNOW;switch(this.currentErrorCode){case"no.activity":r=L.NO_ACTIVITY;break;case"access.not.granted":r=L.WRONG_CREDENTIALS;break;case"session.too.old":r=L.TOO_OLD}const s=new Error(r);this.rejectDeferredPending(s),this.internalEvent.emitError(s)}manageContentChangeMessage(e){i(this,y,"f").info("manageContentChangeMessage",{websocketMessage:e});const t=e,n={canRedo:t.canRedo,canUndo:t.canUndo,empty:t.empty,stackIndex:t.undoStackIndex,possibleUndoCount:t.possibleUndoCount,stack:[]};this.internalEvent.emitContextChange(n)}manageSVGPatchMessage(e){var t;i(this,y,"f").info("manageSVGPatchMessage",{websocketMessage:e}),(t=this.resizeDeferred)===null||t===void 0||t.resolve();const n=e;this.internalEvent.emitSVGPatch(n)}messageCallback(e){var t;i(this,y,"f").debug("messageCallback",{message:e}),this.currentErrorCode=void 0;const n=JSON.parse(e.data);if(n.type!=="pong")switch(this.pingCount=0,n.type){case"ack":this.manageAckMessage(n);break;case"contentPackageDescription":this.manageContentPackageDescriptionMessage();break;case"partChanged":this.managePartChangeMessage(n);break;case"newPart":(t=this.initialized)===null||t===void 0||t.resolve();break;case"contentChanged":this.manageContentChangeMessage(n);break;case"exported":this.manageExportMessage(n);break;case"svgPatch":this.manageSVGPatchMessage(n);break;case"error":this.manageErrorMessage(n);break;case"idle":this.manageWaitForIdle();break;default:i(this,y,"f").warn("messageCallback",`Message type unknow: "${n.type}".`)}}init(e,t){var n,o;return u(this,void 0,void 0,function*(){try{return i(this,y,"f").info("init",{height:e,width:t}),this.destroy(),this.connected=new I,this.initialized=new I,this.ackDeferred=new I,this.viewSizeHeight=e,this.viewSizeWidth=t,this.pingCount=0,this.socket=new WebSocket(this.url),this.serverConfiguration.websocket.pingEnabled&&this.infinitePing(),this.socket.addEventListener("open",this.openCallback.bind(this)),this.socket.addEventListener("close",this.closeCallback.bind(this)),this.socket.addEventListener("message",this.messageCallback.bind(this)),this.initialized.promise}catch{const s=new Error(L.CANT_ESTABLISH);return this.internalEvent.emitError(s),(n=this.initialized)===null||n===void 0||n.reject(s),(o=this.initialized)===null||o===void 0?void 0:o.promise}})}send(e){return u(this,void 0,void 0,function*(){return this.connected?(yield this.connected.promise,this.socket.readyState===this.socket.OPEN?(i(this,y,"f").debug("send",{message:e}),this.socket.send(JSON.stringify(e)),Promise.resolve()):this.socket.readyState!=this.socket.CONNECTING&&this.serverConfiguration.websocket.autoReconnect?(this.reconnectionCount++,this.serverConfiguration.websocket.maxRetryCount>=this.reconnectionCount?(i(this,y,"f").debug("send",`try to reconnect number: ${this.reconnectionCount}.`),this.internalEvent.emitClearMessage(),yield this.init(this.viewSizeHeight,this.viewSizeWidth),yield this.setPenStyle(this.penStyle),yield this.setPenStyleClasses(this.penStyleClasses),yield this.setTheme(this.theme),this.send(e)):Promise.reject(new Error("Unable to send message. The maximum number of connection attempts has been reached."))):void 0):Promise.reject(new Error("Recognizer must be initilized"))})}addStrokes(e){var t,n;return u(this,void 0,void 0,function*(){return i(this,y,"f").info("addStrokes",{strokes:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise,this.addStrokeDeferred=new I,e.length===0?this.addStrokeDeferred.resolve({}):yield this.send({type:"addStrokes",strokes:e.map(o=>o.formatToSend())}),(n=this.addStrokeDeferred)===null||n===void 0?void 0:n.promise})}setPenStyle(e){var t;return u(this,void 0,void 0,function*(){i(this,y,"f").info("setPenStyle",{penStyle:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise,this.penStyle=e;const n={type:"setPenStyle",style:tt.penStyleToCSS(e)};return this.send(n)})}setPenStyleClasses(e){var t;return u(this,void 0,void 0,function*(){yield(t=this.initialized)===null||t===void 0?void 0:t.promise,this.penStyleClasses=e,i(this,y,"f").info("setPenStyleClasses",{penStyleClasses:e});const n={type:"setPenStyleClasses",styleClasses:e};return this.send(n)})}setTheme(e){var t;return u(this,void 0,void 0,function*(){i(this,y,"f").info("setTheme",{theme:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise,this.theme=e;const n={type:"setTheme",theme:tt.themeToCSS(e)};return this.send(n)})}export(e,t){var n,o;return u(this,void 0,void 0,function*(){i(this,y,"f").info("export",{model:e,requestedMimeTypes:t}),yield(n=this.initialized)===null||n===void 0?void 0:n.promise,this.exportDeferred=new I;const r=e.getClone();let s=t||[];if(!s.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":s=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":s=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":s=["application/vnd.myscript.jiix"];break;case"TEXT":s=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.
 Possible types are:
 -DIAGRAM
 -MATH
 -Raw Content
 -TEXT`)}if(!s.length)return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${this.recognitionConfiguration.type} configuration`));const d={type:"export",partId:this.currentPartId,mimeTypes:s};yield this.send(d);const l=yield(o=this.exportDeferred)===null||o===void 0?void 0:o.promise;return r.updatePositionReceived(),r.mergeExport(l),i(this,y,"f").debug("export",{model:r}),r})}import(e,t,n){var o,r;return u(this,void 0,void 0,function*(){i(this,y,"f").info("import",{data:t,mimeType:n}),yield(o=this.initialized)===null||o===void 0?void 0:o.promise;const s=e.getClone(),d=this.serverConfiguration.websocket.fileChunkSize,l=Math.random().toString(10).substring(2,6);this.importDeferred=new I;const c=m=>{const v=new FileReader;return new Promise((C,P)=>{v.onloadend=Y=>{var Z;return C((Z=Y.target)===null||Z===void 0?void 0:Z.result)},v.onerror=()=>P(),v.readAsText(m)})},g={type:"importFile",importFileId:l,mimeType:n};yield this.send(g);for(let m=0;m<t.size;m+=d){const v=t.slice(m,m+d,t.type),C={type:"fileChunk",importFileId:l,data:yield c(v),lastChunk:m+d>t.size};yield this.send(C)}const p=yield(r=this.importDeferred)===null||r===void 0?void 0:r.promise;return this.importDeferred=void 0,s.mergeExport(p),s})}resize(e){var t,n;return u(this,void 0,void 0,function*(){i(this,y,"f").info("resize",{model:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise,this.resizeDeferred=new I;const o=e.getClone();this.viewSizeHeight=o.height,this.viewSizeWidth=o.width;const r={type:"changeViewSize",height:this.viewSizeHeight,width:this.viewSizeWidth};return yield this.send(r),yield(n=this.resizeDeferred)===null||n===void 0?void 0:n.promise,o})}importPointEvents(e){var t,n;return u(this,void 0,void 0,function*(){i(this,y,"f").info("importPointsEvents",{strokes:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise,this.importPointEventsDeferred=new I;const o={type:"pointerEvents",events:e.map(s=>s.formatToSend())};this.send(o);const r=yield(n=this.importPointEventsDeferred)===null||n===void 0?void 0:n.promise;return this.importPointEventsDeferred=void 0,i(this,y,"f").debug("importPointEvents",{exportPoints:r}),r})}convert(e,t){var n,o;return u(this,void 0,void 0,function*(){i(this,y,"f").info("convert",{model:e,conversionState:t}),yield(n=this.initialized)===null||n===void 0?void 0:n.promise,this.convertDeferred=new I;const r=e.getClone(),s={type:"convert",conversionState:t};yield this.send(s);const d=yield(o=this.convertDeferred)===null||o===void 0?void 0:o.promise;return r.updatePositionReceived(),r.mergeConvert(d),i(this,y,"f").debug("convert",{model:r}),r})}waitForIdle(){var e,t;return u(this,void 0,void 0,function*(){return yield(e=this.initialized)===null||e===void 0?void 0:e.promise,this.waitForIdleDeferred=new I,yield this.send({type:"waitForIdle"}),(t=this.waitForIdleDeferred)===null||t===void 0?void 0:t.promise})}undo(e){var t,n;return u(this,void 0,void 0,function*(){i(this,y,"f").info("undo",{model:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise;const o=e.getClone();this.undoDeferred=new I,yield this.send({type:"undo"});const r=yield(n=this.undoDeferred)===null||n===void 0?void 0:n.promise;return o.updatePositionReceived(),o.mergeExport(r),i(this,y,"f").debug("undo",{model:o}),this.undoDeferred=void 0,o})}redo(e){var t,n;return u(this,void 0,void 0,function*(){i(this,y,"f").info("redo",{model:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise;const o=e.getClone();this.redoDeferred=new I,yield this.send({type:"redo"});const r=yield(n=this.redoDeferred)===null||n===void 0?void 0:n.promise;return o.updatePositionReceived(),o.mergeExport(r),i(this,y,"f").debug("redo",{model:r}),this.redoDeferred=void 0,o})}clear(e){var t,n;return u(this,void 0,void 0,function*(){i(this,y,"f").info("clear",{model:e}),yield(t=this.initialized)===null||t===void 0?void 0:t.promise;const o=e.getClone();o.modificationDate=Date.now(),this.clearDeferred=new I,yield this.send({type:"clear"});const r=yield(n=this.clearDeferred)===null||n===void 0?void 0:n.promise;return o.updatePositionReceived(),o.mergeExport(r),this.clearDeferred=void 0,i(this,y,"f").info("clear",{model:o}),o})}close(e,t){this.socket.readyState!==this.socket.OPEN&&this.socket.readyState!==this.socket.CONNECTING||(i(this,y,"f").info("close",{code:e,reason:t}),this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),this.socket.close(e,t))}destroy(){i(this,y,"f").info("destroy"),this.connected=void 0,this.initialized=void 0,this.ackDeferred=void 0,this.addStrokeDeferred=void 0,this.exportDeferred=void 0,this.convertDeferred=void 0,this.importDeferred=void 0,this.resizeDeferred=void 0,this.undoDeferred=void 0,this.redoDeferred=void 0,this.clearDeferred=void 0,this.socket&&(this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),this.close(1e3,"Recognizer destroyed"))}}y=new WeakMap;class _i{constructor(){J.set(this,T.getLogger("RENDERER")),this.symbols={table:"table",ellipse:"ellipse",line:"line"}}phi(e){let t=(e+Math.PI)%(2*Math.PI)-Math.PI;return t<-Math.PI&&(t+=2*Math.PI),i(this,J,"f").debug("phi",{angle:e,returnedAngle:t}),t}drawEllipseArc(e,t){i(this,J,"f").debug("drawEllipseArc",{context2D:e,shapeEllipse:t});const{centerPoint:n,maxRadius:o,minRadius:r,orientation:s,startAngle:d,sweepAngle:l}=t,c=Math.cos(s)*o,g=Math.cos(s)*r,p=Math.sin(s)*o,m=Math.sin(s)*r,v=Math.floor(Math.abs(l)/.02),C=[];e.save();try{e.beginPath();for(let P=0;P<=v;P++){const Y=d+P/v*l,Z=Math.atan2(Math.sin(Y)/r,Math.cos(Y)/o),_e=Math.cos(Z),je=Math.sin(Z),Ae=n.x+c*_e-m*je,Re=n.y+g*je+p*_e;P===0?e.moveTo(Ae,Re):e.lineTo(Ae,Re),P!==0&&P!==v||C.push({x:Ae,y:Re})}e.stroke()}catch(P){i(this,J,"f").error("drawEllipseArc",{error:P})}finally{e.restore()}return C}drawLine(e,t,n){i(this,J,"f").debug("drawLine",{context2D:e,p1:t,p2:n}),e.save();try{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}catch(o){i(this,J,"f").error("drawLine",{error:o})}finally{e.restore()}}drawArrowHead(e,t,n,o){i(this,J,"f").debug("drawArrowHead",{context2D:e,headPoint:t,angle:n,length:o});const r=this.phi(n+Math.PI*(7/8)),s=this.phi(n-Math.PI*(7/8));e.save();try{e.fillStyle=e.strokeStyle,e.moveTo(t.x,t.y),e.beginPath(),e.lineTo(t.x+o*Math.cos(r),t.y+o*Math.sin(r)),e.lineTo(t.x+o*Math.cos(s),t.y+o*Math.sin(s)),e.lineTo(t.x,t.y),e.fill()}catch(d){i(this,J,"f").error("drawArrowHead",{error:d})}finally{e.restore()}}drawShapeEllipse(e,t){i(this,J,"f").debug("drawShapeEllipse",{context2D:e,shapeEllipse:t});const n=this.drawEllipseArc(e,t);(t==null?void 0:t.beginDecoration)==="ARROW_HEAD"&&this.drawArrowHead(e,n[0],t.beginTangentAngle,12),(t==null?void 0:t.endDecoration)==="ARROW_HEAD"&&this.drawArrowHead(e,n[1],t.endTangentAngle,12)}drawShapeLine(e,t){i(this,J,"f").debug("drawShapeLine",{context2D:e,shapeLine:t}),this.drawLine(e,t.firstPoint,t.lastPoint),t.beginDecoration==="ARROW_HEAD"&&this.drawArrowHead(e,t.firstPoint,t.beginTangentAngle,12),t.endDecoration==="ARROW_HEAD"&&this.drawArrowHead(e,t.lastPoint,t.endTangentAngle,12)}draw(e,t){switch(i(this,J,"f").info("draw",{context2D:e,symbol:t}),e.save(),e.lineWidth=t.style.width,e.strokeStyle=t.style.color,t.type){case this.symbols.table:t.lines.forEach(n=>this.drawLine(e,n.p1,n.p2));break;case this.symbols.ellipse:this.drawShapeEllipse(e,t);break;case this.symbols.line:this.drawShapeLine(e,t);break;default:i(this,J,"f").warn("draw",`${t.type} not implemented`)}}}J=new WeakMap;class ji{constructor(){Ee.set(this,T.getLogger("RENDERER"))}renderArc(e,t,n){i(this,Ee,"f").debug("renderArc",{context2d:e,center:t,radius:n}),e.arc(t.x,t.y,n,0,2*Math.PI,!0)}renderLine(e,t,n,o){i(this,Ee,"f").debug("renderLine",{context2d:e,begin:t,end:n,width:o});const r=B(t,F(t,n),o),s=B(n,F(t,n),o);e.moveTo(r[0].x,r[0].y),e.lineTo(s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.lineTo(r[1].x,r[1].y)}renderFinal(e,t,n,o){i(this,Ee,"f").debug("renderFinal",{context2d:e,begin:t,end:n,width:o});const r=F(t,n),s=B(n,r,o);e.moveTo(s[0].x,s[0].y);for(let d=1;d<=6;d++){const l=r-d*Math.PI/6;e.lineTo(n.x-n.p*o*Math.sin(l),n.y+n.p*o*Math.cos(l))}}renderQuadratic(e,t,n,o,r){i(this,Ee,"f").debug("renderQuadratic",{context2d:e,begin:t,end:n,ctrl:o,width:r});const s=B(t,F(t,o),r),d=B(n,F(o,n),r),l=B(o,F(t,n),r);e.moveTo(s[0].x,s[0].y),e.quadraticCurveTo(l[0].x,l[0].y,d[0].x,d[0].y),e.lineTo(d[1].x,d[1].y),e.quadraticCurveTo(l[1].x,l[1].y,s[1].x,s[1].y)}draw(e,t){i(this,Ee,"f").info("draw",{context2d:e,stroke:t});const n=t.pointers.length,o=n-2,r=t.style.width>0?t.style.width:e.lineWidth,s=t.style.color?t.style.color:e.strokeStyle,d=t.pointers[0];e.save();try{if(e.beginPath(),n<3)this.renderArc(e,d,.6*r);else{this.renderArc(e,d,r*d.p);const l=de(d,t.pointers[1]);this.renderLine(e,d,l,r);for(let v=0;v<o;v++){const C=de(t.pointers[v],t.pointers[v+1]),P=de(t.pointers[v+1],t.pointers[v+2]),Y=t.pointers[v+1];this.renderQuadratic(e,C,P,Y,r)}const c=de(t.pointers[n-2],t.pointers[n-1]),g=t.pointers[n-1];this.renderLine(e,c,g,r);const p=t.pointers[n-2],m=t.pointers[n-1];this.renderFinal(e,p,m,r)}e.closePath(),s!==void 0&&(e.fillStyle=s,e.fill()),e.save()}catch(l){i(this,Ee,"f").error("draw",{error:l})}finally{e.restore()}}}Ee=new WeakMap;class Wi{constructor(){ce.set(this,T.getLogger("RENDERER")),this.symbols={char:"char",string:"string",textLine:"textLine"}}drawUnderline(e,t,n){i(this,ce,"f").debug("#drawUnderline",{context2D:e,textUnderline:t,underline:n}),e.save();try{const o=t.data.width/t.label.length,r={x:t.data.topLeftPoint.x+n.data.firstCharacter*o,y:t.data.topLeftPoint.y+t.data.height},s={x:t.data.topLeftPoint.x+n.data.lastCharacter*o,y:t.data.topLeftPoint.y+t.data.height};e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(s.x,s.y),e.stroke()}catch(o){i(this,ce,"f").error("#drawUnderline",{error:o})}finally{e.restore()}}drawText(e,t){i(this,ce,"f").debug("#drawText",{context2D:e,text:t}),e.save();try{e.font=`${t.data.textHeight}px serif`,e.textAlign=t.data.justificationType==="CENTER"?"center":"left",e.textBaseline="bottom",e.fillStyle=e.strokeStyle,e.fillText(t.label,t.data.topLeftPoint.x,t.data.topLeftPoint.y+t.data.height)}catch(n){i(this,ce,"f").error("#drawText",{error:n})}finally{e.restore()}}drawTextLine(e,t){i(this,ce,"f").debug("#drawTextLine",{context2D:e,textUnderline:t}),this.drawText(e,t),t.underlineList.forEach(n=>{this.drawUnderline(e,t,n)})}draw(e,t){switch(i(this,ce,"f").info("draw",{context2D:e,symbol:t}),e.lineWidth=t.style.width,e.strokeStyle=t.style.color,t.type){case this.symbols.char:case this.symbols.string:this.drawText(e,t);break;case this.symbols.textLine:this.drawTextLine(e,t);break;default:i(this,ce,"f").warn("draw",`${t.type} not implemented`)}}}ce=new WeakMap;class $i{constructor(e){ee.set(this,T.getLogger("RENDERER")),i(this,ee,"f").info("constructor",{config:e}),this.configuration=e,this.strokeRenderer=new ji,this.shapeRenderer=new _i,this.textRenderer=new Wi}createCanvas(e){i(this,ee,"f").debug("createCanvas",{type:e});const t=document.createElement("canvas");return t.id=e,t.classList.add(e),t.classList.add("ms-canvas"),t}resizeContent(){const e=window.devicePixelRatio;[this.context.renderingCanvas,this.context.capturingCanvas].forEach(t=>{var n;const o=t.parentNode,r=Math.max(this.configuration.minWidth,o.clientWidth),s=Math.max(this.configuration.minHeight,o.clientHeight);t.width=r*e,t.height=s*e,(n=t.getContext("2d"))===null||n===void 0||n.scale(e,e),t.style.width=`${r}px`,t.style.height=`${s}px`})}drawSymbol(e,t){if(i(this,ee,"f").debug("drawSymbol",{symbol:t}),t.type==="stroke"){const n=t;n.pointerType!=="eraser"&&this.strokeRenderer.draw(e,n)}else Object.keys(this.textRenderer.symbols).includes(t.type)?this.textRenderer.draw(e,t):Object.keys(this.shapeRenderer.symbols).includes(t.type)?this.shapeRenderer.draw(e,t):i(this,ee,"f").warn("drawSymbol",`symbol type unknow: ${t.type}`)}init(e){i(this,ee,"f").info("init",{element:e});const t=this.createCanvas("ms-rendering-canvas");e.appendChild(t);const n=this.createCanvas("ms-capture-canvas");e.appendChild(n),this.context={parent:e,renderingCanvas:t,renderingCanvasContext:t.getContext("2d"),capturingCanvas:n,capturingCanvasContext:n.getContext("2d")},this.resizeContent()}drawModel(e){var t;i(this,ee,"f").info("drawModel",{model:e}),(t=this.context.renderingCanvasContext)===null||t===void 0||t.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height),e.symbols.forEach(n=>this.drawSymbol(this.context.renderingCanvasContext,n)),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height)}drawPendingStroke(e){i(this,ee,"f").info("drawPendingStroke",{stroke:e}),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),e&&(e==null?void 0:e.pointerType)!=="eraser"&&this.strokeRenderer.draw(this.context.capturingCanvasContext,e)}resize(e){i(this,ee,"f").info("resize",{model:e}),this.resizeContent(),this.drawModel(e)}destroy(){i(this,ee,"f").info("destroy"),this.context.parent&&(this.context.parent.innerHTML="")}}ee=new WeakMap;class Hi{getArcPath(e,t){return[`M ${e.x},${e.y}`,`m ${-t},0`,`a ${t},${t} 0 1 0 ${2*t},0`,`a ${t},${t} 0 1 0 ${-2*t},0`].join(" ")}getLinePath(e,t,n){const o=B(e,F(e,t),n),r=B(t,F(e,t),n);return[`M ${o[0].x},${o[0].y}`,`L ${r[0].x},${r[0].y}`,`L ${r[1].x},${r[1].y}`,`L ${o[1].x},${o[1].y}`].join(" ")}getFinalPath(e,t,n){const o=F(e,t),r=B(t,o,n),s=[`M ${r[0].x},${r[0].y}`];for(let d=1;d<=6;d++){const l=o-d*(Math.PI/6);s.push(`L ${t.x-t.p*n*Math.sin(l)},${t.y+t.p*n*Math.cos(l)}`)}return s.join(" ")}getQuadraticPath(e,t,n,o){const r=B(e,F(e,n),o),s=B(t,F(n,t),o),d=B(n,F(e,t),o);return[`M ${r[0].x},${r[0].y}`,`Q ${d[0].x},${d[0].y} ${s[0].x},${s[0].y}`,`L ${s[1].x},${s[1].y}`,`Q ${d[1].x},${d[1].y} ${r[1].x},${r[1].y}`].join(" ")}buildSVGPath(e){const t=e.pointers.length,n=e.style.width,o=t-2,r=e.pointers[0],s=[];if(t<3)s.push(this.getArcPath(r,.6*n));else{s.push(this.getArcPath(r,n*r.p)),s.push(this.getLinePath(r,de(r,e.pointers[1]),n));for(let c=0;c<o;c++){const g=de(e.pointers[c],e.pointers[c+1]),p=de(e.pointers[c+1],e.pointers[c+2]),m=e.pointers[c+1];s.push(this.getQuadraticPath(g,p,m,n))}const d=e.pointers[t-2],l=e.pointers[t-1];s.push(this.getLinePath(de(d,l),l,n)),s.push(this.getFinalPath(d,l,n))}return s.join(" ")}drawStroke(e,t,n){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.classList.add("pending-stroke"),o.setAttribute("id",t.id),o.setAttribute("type",t.pointerType),n==null||n.forEach(s=>{o.setAttribute(s.name,s.value)});const r=this.buildSVGPath(t);o.setAttribute("d",`${r}Z`),e.appendChild(o)}}class Gi{constructor(e){te.set(this,T.getLogger("RENDERER")),i(this,te,"f").info("constructor",{config:e}),this.config=e,this.stroker=new Hi}init(e){i(this,te,"f").info("init",{element:e}),e.style.fontSize="10px",this.context={parent:e}}drawStroke(e,t){let n;t.pointerType==="eraser"?(t.style.width=20,n="fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;"):n=`fill:${t.style.color};stroke:transparent;`,this.stroker.drawStroke(e,t,[{name:"style",value:n}])}replaceAll(e,t){const n=this.context.parent.querySelector(`svg[data-layer="${e}"]`);n==null||n.remove(),this.context.parent.insertAdjacentHTML("beforeend",t.svg);const o=this.context.parent.querySelector(`svg[data-layer="${e}"]`);if(e==="MODEL"){const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.id="pendingStrokes",o.appendChild(r)}}replaceElement(e){const t=this.context.parent.querySelector(`#${e.id}`);if(t){const n=t.parentNode;t==null||t.remove(),n==null||n.insertAdjacentHTML("beforeend",e.svg)}}appendChild(e,t){const n=t.parentId?`#${t.parentId}`:`svg[data-layer="${e}"]`,o=this.context.parent.querySelector(n);o==null||o.insertAdjacentHTML("beforeend",t.svg)}removeChild(e){var t;(t=this.context.parent.querySelector(`#${e.parentId} > *:nth-child(${e.index+1})`))===null||t===void 0||t.remove()}removeElement(e){const t=this.context.parent.querySelector(`#${e.id}`);t&&(e.id.includes("s")||e.id.includes("MODEL")?t.remove():(t.setAttribute("class","removed-stroke"),setTimeout(()=>{t==null||t.remove()},100)))}insertBefore(e){const t=this.context.parent.querySelector(`#${e.refId}`);t==null||t.insertAdjacentHTML("beforebegin",e.svg)}setAttribute(e){const t=e.id?`#${e.id}`:"svg",n=this.context.parent.querySelector(t);n==null||n.setAttribute(e.name,e.value)}removeAttribute(e){const t=e.id?`#${e.id}`:"svg",n=this.context.parent.querySelector(t);n==null||n.removeAttribute(e.name)}updateLayer(e,t){switch(i(this,te,"f").info("updateLayer",{layerName:e,update:t}),t.type){case"REPLACE_ALL":this.replaceAll(e,t);break;case"REPLACE_ELEMENT":this.replaceElement(t);break;case"APPEND_CHILD":this.appendChild(e,t);break;case"REMOVE_ELEMENT":this.removeElement(t);break;case"REMOVE_CHILD":this.removeChild(t);break;case"INSERT_BEFORE":this.insertBefore(t);break;case"SET_ATTRIBUTE":this.setAttribute(t);break;case"REMOVE_ATTRIBUTE":this.removeAttribute(t);break;default:i(this,te,"f").warn("updateLayer",`update.type unknow ${t.type}`)}}updatesLayer(e,t){i(this,te,"f").info("updatesLayer",{layerName:e,updates:t}),t.forEach(n=>this.updateLayer(e,n)),this.clearPendingStroke()}clearPendingStroke(){i(this,te,"f").info("clearPendingStroke");const e=this.context.parent.querySelector("#pendingStrokes");e&&(e.innerHTML="")}drawPendingStroke(e){if(i(this,te,"f").info("drawPendingStroke",{stroke:e}),e){const t=this.context.parent.querySelector("#pendingStrokes");if(t){const n=t.querySelector(`#${e==null?void 0:e.id}`);n&&n.remove(),this.drawStroke(t,e)}}}clearErasingStrokes(){this.context.parent.querySelectorAll("[type=eraser]").forEach(e=>{e.remove()})}resize(e){i(this,te,"f").info("resize",{model:e});const t=this.context.parent.getBoundingClientRect(),n=this.context.parent.querySelectorAll("svg"),o=Math.max(t.width,e.width),r=Math.max(t.height,e.height);n.forEach(s=>{s.setAttribute("viewBox",`0 0 ${o}, ${r}`),s.setAttribute("width",`${o}px`),s.setAttribute("height",`${r}px`)})}destroy(){var e;i(this,te,"f").info("destroy",{context:this.context}),!((e=this.context)===null||e===void 0)&&e.parent&&this.context.parent.querySelectorAll("svg").forEach(t=>t.remove())}}te=new WeakMap;class At{constructor(e){this.stackIndex=0,this.possibleUndoCount=0,this.canRedo=!1,this.canUndo=!1,this.empty=!0,this.stack=[e.getClone()]}}class Rt{constructor(e,t){ie.set(this,T.getLogger("UNDO_REDO")),i(this,ie,"f").info("constructor",{configuration:e,model:t}),this.configuration=e,this.context=new At(t)}get internalEvent(){return we.getInstance()}updateCanUndoRedo(){this.context.canRedo=this.context.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0;const e=this.context.stack[this.context.stackIndex];this.context.empty=e.symbols.length===0}addModelToStack(e){i(this,ie,"f").info("addModelToStack",{model:e}),this.context.stackIndex+1<this.context.stack.length&&this.context.stack.splice(this.context.stackIndex+1),this.context.stack.push(e.getClone()),this.context.stackIndex=this.context.stack.length-1,this.context.stack.length>this.configuration.maxStackSize&&(this.context.stack.shift(),this.context.stackIndex--),this.updateCanUndoRedo(),this.internalEvent.emitContextChange(this.context)}removeLastModelInStack(){i(this,ie,"f").info("removeLastModelInStack"),this.context.stackIndex===this.context.stack.length-1&&this.context.stackIndex--,this.context.stack.pop(),this.updateCanUndoRedo()}updateModelInStack(e){i(this,ie,"f").info("updateModelInStack",{model:e});const t=this.context.stack.findIndex(n=>n.modificationDate===e.modificationDate);t>-1&&this.context.stack.splice(t,1,e.getClone()),this.updateCanUndoRedo(),this.internalEvent.emitContextChange(this.context)}undo(){i(this,ie,"f").info("undo"),this.context.canUndo&&(this.context.stackIndex--,this.updateCanUndoRedo(),this.internalEvent.emitContextChange(this.context));const e=this.context.stack[this.context.stackIndex].getClone();return i(this,ie,"f").debug("undo",e),e}redo(){i(this,ie,"f").info("redo"),this.context.canRedo&&(this.context.stackIndex++,this.updateCanUndoRedo(),this.internalEvent.emitContextChange(this.context));const e=this.context.stack[this.context.stackIndex].getClone();return i(this,ie,"f").debug("redo",e),e}reset(e){i(this,ie,"f").info("reset",{model:e}),this.context=new At(e),this.internalEvent.emitContextChange(this.context)}}ie=new WeakMap;class Ui{constructor(e){this.name="RestBehaviors",w.set(this,T.getLogger("BEHAVIORS")),H.set(this,void 0),M.set(this,void 0),it.set(this,void 0),nt.set(this,void 0),i(this,w,"f").info("constructor",{options:e}),f(this,H,new wt(e==null?void 0:e.configuration),"f"),this.styleManager=new It(e==null?void 0:e.penStyle,e==null?void 0:e.theme),this.grabber=new Ct(i(this,H,"f").grabber),this.renderer=new $i(i(this,H,"f").rendering),this.recognizer=new Oi(i(this,H,"f").server,i(this,H,"f").recognition),this.intention="write",f(this,M,new qe,"f"),this.undoRedoManager=new Rt(i(this,H,"f")["undo-redo"],this.model)}onPointerDown(e,t){var n;i(this,w,"f").info("onPointerDown",{intention:this.intention,evt:e,point:t});const{pointerType:o}=e,r=Object.assign({},(n=this.theme)===null||n===void 0?void 0:n.ink,this.currentPenStyle);switch(this.intention){case"erase":this.model.removeStrokesFromPoint(t).length>0&&this.renderer.drawModel(this.model);break;case"write":this.model.initCurrentStroke(t,e.pointerId,o,r),this.drawCurrentStroke();break;default:i(this,w,"f").warn("#onPointerDown",`onPointerDown intention unknow: "${this.intention}"`)}}onPointerMove(e,t){switch(i(this,w,"f").info("onPointerMove",{intention:this.intention,point:t}),this.intention){case"erase":this.model.removeStrokesFromPoint(t).length>0&&this.renderer.drawModel(this.model);break;case"write":this.model.appendToCurrentStroke(t),this.drawCurrentStroke();break;default:i(this,w,"f").warn("#onPointerMove",`onPointerMove intention unknow: "${this.intention}"`)}}onPointerUp(e,t){var n;return u(this,void 0,void 0,function*(){switch(i(this,w,"f").info("onPointerUp",{intention:this.intention,point:t}),this.intention){case"erase":this.model.removeStrokesFromPoint(t),((n=this.context.stack.at(-1))===null||n===void 0?void 0:n.modificationDate)!==this.model.modificationDate&&(yield this.updateModelRendering());break;case"write":this.model.endCurrentStroke(t),yield this.updateModelRendering();break;default:i(this,w,"f").warn("#onPointerUp",`onPointerUp intention unknow: "${this.intention}"`)}})}get internalEvent(){return we.getInstance()}get model(){return i(this,M,"f")}get context(){return this.undoRedoManager.context}get currentPenStyle(){return this.styleManager.currentPenStyle}get penStyle(){return this.styleManager.penStyle}setPenStyle(e){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("setPenStyle",{penStyle:e}),this.styleManager.setPenStyle(e),Promise.resolve()})}get penStyleClasses(){return this.styleManager.penStyleClasses}setPenStyleClasses(e){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("setPenStyleClasses",{penStyleClasses:e}),this.styleManager.setPenStyleClasses(e),Promise.resolve()})}get theme(){return this.styleManager.theme}setTheme(e){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("setTheme",{theme:e}),this.styleManager.setTheme(e),Promise.resolve()})}get configuration(){return i(this,H,"f")}init(e){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("init",{domElement:e}),this.model.width=Math.max(e.clientWidth,i(this,H,"f").rendering.minWidth),this.model.height=Math.max(e.clientHeight,i(this,H,"f").rendering.minHeight),this.undoRedoManager.updateModelInStack(this.model),this.renderer.init(e),this.grabber.attach(e),this.grabber.onPointerDown=this.onPointerDown.bind(this),this.grabber.onPointerMove=this.onPointerMove.bind(this),this.grabber.onPointerUp=this.onPointerUp.bind(this),Promise.resolve()})}drawCurrentStroke(){i(this,w,"f").debug("drawCurrentStroke",{stroke:this.model.currentSymbol}),this.renderer.drawPendingStroke(this.model.currentSymbol)}updateModelRendering(){return u(this,void 0,void 0,function*(){i(this,w,"f").info("updateModelRendering"),this.renderer.drawModel(this.model);const e=new I;if(this.undoRedoManager.addModelToStack(this.model),i(this,H,"f").triggers.exportContent!=="DEMAND"){clearTimeout(i(this,nt,"f"));let t=this.model.getClone();f(this,nt,setTimeout(()=>u(this,void 0,void 0,function*(){try{t=yield this.recognizer.export(t),this.undoRedoManager.updateModelInStack(t),this.model.modificationDate===t.modificationDate&&(this.model.exports=t.exports),e.resolve(this.model)}catch(n){i(this,w,"f").error("updateModelRendering",{error:n}),this.internalEvent.emitError(n),e.reject(n)}}),i(this,H,"f").triggers.exportContent==="QUIET_PERIOD"?i(this,H,"f").triggers.exportContentDelay:0),"f")}else e.resolve(this.model);return yield e.promise,this.internalEvent.emitExported(this.model.exports),i(this,w,"f").debug("updateModelRendering",this.model.exports),e.promise})}export(e){return u(this,void 0,void 0,function*(){i(this,w,"f").info("export",{mimeTypes:e});const t=yield this.recognizer.export(this.model.getClone(),e);return this.model.modificationDate===t.modificationDate&&this.model.mergeExport(t.exports),this.undoRedoManager.updateModelInStack(t),i(this,w,"f").debug("export",this.model),this.model})}convert(e,t){return u(this,void 0,void 0,function*(){i(this,w,"f").info("convert",{conversionState:e,requestedMimeTypes:t});const n=yield this.recognizer.convert(this.model,e,t);return Object.assign(i(this,M,"f"),n),i(this,w,"f").debug("convert",this.model),this.model})}importPointEvents(e){return u(this,void 0,void 0,function*(){const t=[];e.forEach((n,o)=>{var r,s;let d=!0;const l=new Ie(n.style||Ge,n.pointerId||1);if(n.id&&(l.id=n.id),!(!((r=n.pointers)===null||r===void 0)&&r.length))return t.push(`stroke ${o+1} has not pointers`),void(d=!1);(s=n.pointers)===null||s===void 0||s.forEach((c,g)=>{if(!c)return t.push(`stroke ${o+1} has no pointer at ${g}`),void(d=!1);const p={p:c.p||1,t:c.t||g,x:0,y:0};return(c==null?void 0:c.x)==null||(c==null?void 0:c.x)==null?(t.push(`stroke ${o+1} has no x at pointer at ${g}`),void(d=!1)):(p.x=c.x,(c==null?void 0:c.y)==null||(c==null?void 0:c.y)==null?(t.push(`stroke ${o+1} has no y at pointer at ${g}`),void(d=!1)):(p.y=c.y,void(d&&l.pointers.push(p))))}),d&&this.model.addStroke(l)}),t.length&&this.internalEvent.emitError(new Error(t.join(`
`)));try{const n=yield this.updateModelRendering();return Object.assign(i(this,M,"f"),n),this.model}catch(n){throw this.internalEvent.emitError(n),n}})}resize(e,t){return u(this,void 0,void 0,function*(){i(this,w,"f").info("resize",{height:e,width:t});const n=new I;return this.model.height=e,this.model.width=t,this.renderer.resize(this.model),this.model.symbols.length?(clearTimeout(i(this,it,"f")),f(this,it,setTimeout(()=>u(this,void 0,void 0,function*(){const o=yield this.recognizer.resize(this.model);n.resolve(o)}),i(this,H,"f").triggers.resizeTriggerDelay),"f")):n.resolve(this.model),f(this,M,yield n.promise,"f"),i(this,w,"f").debug("resize",{model:this.model}),this.internalEvent.emitExported(this.model.exports),this.model})}undo(){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("undo"),f(this,M,this.undoRedoManager.undo(),"f"),this.renderer.drawModel(i(this,M,"f")),f(this,M,yield this.recognizer.export(i(this,M,"f")),"f"),this.undoRedoManager.updateModelInStack(i(this,M,"f")),this.internalEvent.emitExported(i(this,M,"f").exports),i(this,w,"f").debug("undo",i(this,M,"f")),i(this,M,"f")})}redo(){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("redo"),f(this,M,this.undoRedoManager.redo(),"f"),this.renderer.drawModel(i(this,M,"f")),f(this,M,yield this.recognizer.export(i(this,M,"f")),"f"),this.undoRedoManager.updateModelInStack(i(this,M,"f")),this.internalEvent.emitExported(i(this,M,"f").exports),i(this,w,"f").debug("redo",i(this,M,"f")),i(this,M,"f")})}clear(){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("clear"),this.model.clear(),this.undoRedoManager.addModelToStack(this.model),this.renderer.drawModel(this.model),this.internalEvent.emitExported(this.model.exports),i(this,w,"f").debug("clear",this.model),this.model})}destroy(){return u(this,void 0,void 0,function*(){return i(this,w,"f").info("destroy"),this.grabber.detach(),this.renderer.destroy(),Promise.resolve()})}}w=new WeakMap,H=new WeakMap,M=new WeakMap,it=new WeakMap,nt=new WeakMap;class Fi{constructor(e){this.name="WSBehaviors",x.set(this,T.getLogger("BEHAVIORS")),G.set(this,void 0),ue.set(this,void 0),ot.set(this,void 0),i(this,x,"f").info("constructor",{options:e}),f(this,G,new wt(e==null?void 0:e.configuration),"f"),this.styleManager=new It(e==null?void 0:e.penStyle,e==null?void 0:e.theme),this.grabber=new Ct(i(this,G,"f").grabber),this.renderer=new Gi(i(this,G,"f").rendering),this.recognizer=new zi(i(this,G,"f").server,i(this,G,"f").recognition),this.intention="write",f(this,ue,new qe,"f"),this.undoRedoManager=new Rt(i(this,G,"f")["undo-redo"],this.model)}get internalEvent(){return we.getInstance()}get model(){return i(this,ue,"f")}get context(){return this.undoRedoManager.context}get configuration(){return i(this,G,"f")}get currentPenStyle(){return this.styleManager.currentPenStyle}get penStyle(){return this.styleManager.penStyle}setPenStyle(e){return i(this,x,"f").info("setPenStyle",{penStyle:e}),this.styleManager.setPenStyle(e),i(this,x,"f").debug("setPenStyle",this.styleManager.penStyle),this.recognizer.setPenStyle(this.styleManager.penStyle)}get penStyleClasses(){return this.styleManager.penStyleClasses}setPenStyleClasses(e){return i(this,x,"f").info("setPenStyleClasses",{penClass:e}),this.styleManager.setPenStyleClasses(e),i(this,x,"f").debug("setPenStyleClasses",this.styleManager.penStyleClasses),this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)}get theme(){return this.styleManager.theme}setTheme(e){return i(this,x,"f").info("setTheme",{theme:e}),this.styleManager.setTheme(e),i(this,x,"f").debug("setTheme",this.styleManager.theme),this.recognizer.setTheme(this.styleManager.theme)}onExport(e){i(this,x,"f").debug("onExport",{exports:e}),this.model.mergeExport(e)}onPointerDown(e,t){var n;i(this,x,"f").info("onPointerDown",{intention:this.intention,evt:e,point:t});let{pointerType:o}=e;const r=Object.assign({},(n=this.theme)===null||n===void 0?void 0:n.ink,this.currentPenStyle);this.intention==="erase"&&(o="eraser"),this.model.initCurrentStroke(t,e.pointerId,o,r),this.drawCurrentStroke()}onPointerMove(e,t){i(this,x,"f").info("onPointerMove",{intention:this.intention,point:t}),this.model.appendToCurrentStroke(t),this.drawCurrentStroke()}onPointerUp(e,t){return u(this,void 0,void 0,function*(){try{i(this,x,"f").info("onPointerUp",{intention:this.intention,point:t}),this.model.endCurrentStroke(t),yield this.synchronizeModelWithBackend()}catch(n){this.internalEvent.emitError(n)}})}onSVGPatch(e){i(this,x,"f").info("onSVGPatch",{evt:e}),this.renderer.updatesLayer(e.layer,e.updates)}init(e){return u(this,void 0,void 0,function*(){i(this,x,"f").info("init",{domElement:e});const t=window.getComputedStyle(e);this.model.width=Math.max(parseInt(t.width.replace("px","")),i(this,G,"f").rendering.minWidth),this.model.height=Math.max(parseInt(t.height.replace("px","")),i(this,G,"f").rendering.minHeight),this.undoRedoManager.updateModelInStack(this.model),this.renderer.init(e),this.grabber.attach(e),this.grabber.onPointerDown=this.onPointerDown.bind(this),this.grabber.onPointerMove=this.onPointerMove.bind(this),this.grabber.onPointerUp=this.onPointerUp.bind(this),this.internalEvent.addExportedListener(this.onExport.bind(this)),this.internalEvent.addSVGPatchListener(this.onSVGPatch.bind(this)),yield this.recognizer.init(this.model.height,this.model.width),yield this.setPenStyle(this.penStyle),yield this.setTheme(this.theme),yield this.setPenStyleClasses(this.penStyleClasses)})}drawCurrentStroke(){i(this,x,"f").debug("drawCurrentStroke",{stroke:this.model.currentSymbol});const e=this.model.currentSymbol;e&&this.renderer.drawPendingStroke(e)}synchronizeModelWithBackend(){return u(this,void 0,void 0,function*(){if(i(this,x,"f").info("synchronizeModelWithBackend"),i(this,G,"f").triggers.exportContent!=="DEMAND"){const e=this.model.extractUnsentStrokes();this.model.updatePositionSent(),this.undoRedoManager.addModelToStack(this.model),this.renderer.clearErasingStrokes();const t=yield this.recognizer.addStrokes(e);this.model.mergeExport(t),this.undoRedoManager.updateModelInStack(this.model)}return i(this,x,"f").debug("synchronizeModelWithBackend",this.model),this.model})}waitForIdle(){return u(this,void 0,void 0,function*(){return this.recognizer.waitForIdle()})}export(e){return u(this,void 0,void 0,function*(){i(this,x,"f").info("export",{mimeTypes:e});try{if(i(this,G,"f").triggers.exportContent==="DEMAND"){const t=this.model.extractUnsentStrokes();this.model.updatePositionSent();const n=yield this.recognizer.addStrokes(t);return this.model.updatePositionReceived(),this.model.mergeExport(n),i(this,x,"f").debug("export",this.model),this.model}return this.recognizer.export(this.model,e)}catch(t){return i(this,x,"f").error("export",{error:t}),this.internalEvent.emitError(t),Promise.reject(t)}})}convert(e){return u(this,void 0,void 0,function*(){return i(this,x,"f").info("convert",{conversionState:e}),this.undoRedoManager.addModelToStack(this.model),this.context.stack.push(this.model.getClone()),f(this,ue,yield this.recognizer.convert(this.model,e),"f"),i(this,x,"f").debug("convert",this.model),this.undoRedoManager.addModelToStack(this.model),this.model})}import(e,t){return u(this,void 0,void 0,function*(){i(this,x,"f").info("import",{data:e,mimeType:t}),this.context.stack.push(this.model.getClone());const n=yield this.recognizer.import(this.model,e,t);return this.undoRedoManager.addModelToStack(n),n})}importPointEvents(e){return u(this,void 0,void 0,function*(){i(this,x,"f").info("importPointEvents",{strokes:e});const t=[],n=e.map((r,s)=>{var d,l;const c=new Ie(r.style||Ge,r.pointerId||1);r.id&&(c.id=r.id),r.pointerType&&(c.pointerType=r.pointerType),!((d=r.pointers)===null||d===void 0)&&d.length||t.push(`stroke ${s+1} has not pointers`);let g=!0;return(l=r.pointers)===null||l===void 0||l.forEach((p,m)=>{if(g=!0,!p)return void t.push(`stroke ${s+1} has no pointer at ${m}`);const v={p:p.p||1,t:p.t||m,x:0,y:0};(p==null?void 0:p.x)==null||(p==null?void 0:p.x)==null?(t.push(`stroke ${s+1} has no x at pointer at ${m}`),g=!1):v.x=p.x,(p==null?void 0:p.y)==null||(p==null?void 0:p.y)==null?(t.push(`stroke ${s+1} has no y at pointer at ${m}`),g=!1):v.y=p.y,g&&c.pointers.push(v)}),c});t.length&&this.internalEvent.emitError(new Error(t.join(`
`))),n.map(r=>this.model.addStroke(r));const o=yield this.recognizer.importPointEvents(n);return this.model.mergeExport(o),i(this,x,"f").debug("importPointEvents",this.model),this.model})}resize(e,t){return u(this,void 0,void 0,function*(){i(this,x,"f").info("resize",{height:e,width:t});const n=new I;this.model.height=e,this.model.width=t;const o=this.model.getClone();return this.renderer.resize(o),clearTimeout(i(this,ot,"f")),f(this,ot,setTimeout(()=>u(this,void 0,void 0,function*(){try{const r=yield this.recognizer.resize(o);n.resolve(r)}catch(r){i(this,x,"f").error("resize",{height:e,width:t,error:r}),n.reject(r)}}),i(this,G,"f").triggers.resizeTriggerDelay),"f"),f(this,ue,yield n.promise,"f"),this.internalEvent.emitExported(this.model.exports),i(this,x,"f").debug("resize",this.model),this.model})}undo(){return u(this,void 0,void 0,function*(){if(i(this,x,"f").info("undo"),this.context.canUndo)return f(this,ue,this.undoRedoManager.undo(),"f"),this.recognizer.undo(this.model);throw new Error("Undo not allowed")})}redo(){return u(this,void 0,void 0,function*(){if(i(this,x,"f").info("redo"),this.context.canRedo)return f(this,ue,this.undoRedoManager.redo(),"f"),i(this,x,"f").debug("undo",i(this,ue,"f")),this.recognizer.redo(this.model);throw new Error("Redo not allowed")})}clear(){return u(this,void 0,void 0,function*(){return i(this,x,"f").info("clear"),this.model.clear(),this.undoRedoManager.addModelToStack(this.model),this.recognizer.clear(this.model)})}destroy(){return u(this,void 0,void 0,function*(){return i(this,x,"f").info("destroy"),this.grabber.detach(),this.renderer.destroy(),this.recognizer.destroy(),Promise.resolve()})}}x=new WeakMap,G=new WeakMap,ue=new WeakMap,ot=new WeakMap;class Bi{constructor(){E.add(this),se.set(this,void 0),X.set(this,void 0),pe.set(this,void 0),N.set(this,void 0),ne.set(this,void 0),Te.set(this,void 0),O.set(this,void 0),U.set(this,void 0),fe.set(this,void 0),ge.set(this,void 0),me.set(this,void 0),ze.set(this,void 0),R.set(this,T.getLogger("SMARTGUIDE")),Tt.set(this,e=>{var t,n;i(this,R,"f").info("showCandidates",{target:e});const o=parseInt(e.id.replace("word-","").replace(this.uuid,"")),r=(t=this.jiix)===null||t===void 0?void 0:t.words;this.wordToChange=r[o],this.wordToChange&&(this.wordToChange.id=o.toString(),i(this,O,"f").innerHTML="",!((n=this.wordToChange)===null||n===void 0)&&n.candidates&&(i(this,O,"f").style.display="flex",this.wordToChange.candidates.forEach((s,d)=>{var l;((l=this.wordToChange)===null||l===void 0?void 0:l.label)===s?i(this,O,"f").innerHTML+=`<span id="cdt-${d}${this.uuid}" class="selected-word">${s}</span>`:i(this,O,"f").innerHTML+=`<span id="cdt-${d}${this.uuid}">${s}</span>`}),e.appendChild(i(this,O,"f"))))}),st.set(this,e=>{i(this,R,"f").info("onClickEllipsis",{evt:e}),e.preventDefault(),e.stopPropagation(),i(this,ze,"f")?i(this,E,"m",Le).call(this):i(this,E,"m",Si).call(this),i(this,E,"m",rt).call(this)}),at.set(this,e=>{i(this,R,"f").info("onClickConvert",{evt:e}),e.preventDefault(),e.stopPropagation(),this.internalEvent.emitConvert(),i(this,E,"m",Le).call(this)}),dt.set(this,e=>u(this,void 0,void 0,function*(){i(this,R,"f").info("onClickCopy",{evt:e}),e.preventDefault(),e.stopPropagation();try{i(this,E,"m",Le).call(this);let t="Nothing to copy";if(i(this,N,"f").innerText){t=`"${i(this,N,"f").innerText}" copied to clipboard`;const n=i(this,E,"m",Ci).call(this,i(this,N,"f").innerText);i(this,pe,"f").appendChild(n),i(this,E,"m",ki).call(this,n),document.execCommand("copy"),n.remove()}this.internalEvent.emitNotif({message:t,timeout:1500})}catch(t){i(this,R,"f").error("onClickCopy",t),this.internalEvent.emitError(t)}})),ht.set(this,e=>{i(this,R,"f").info("onClickDelete",{evt:e}),e.preventDefault(),e.stopPropagation(),this.internalEvent.emitClear(),i(this,E,"m",Le).call(this)}),lt.set(this,e=>{var t,n,o,r,s;i(this,R,"f").info("onClickCandidate",{evt:e}),e.preventDefault(),e.stopPropagation();const d=e.target.innerText;((t=this.jiix)===null||t===void 0?void 0:t.words)&&d!==((n=this.wordToChange)===null||n===void 0?void 0:n.label)&&((r=(o=this.wordToChange)===null||o===void 0?void 0:o.candidates)===null||r===void 0?void 0:r.includes(d))&&(this.jiix.words[parseInt((s=this.wordToChange)===null||s===void 0?void 0:s.id)].label=d,this.internalEvent.emitImportJIIX(this.jiix)),i(this,O,"f").style.display="none"}),ct.set(this,e=>{i(this,R,"f").info("onClickPrompter",{evt:e}),e.preventDefault(),e.stopPropagation(),i(this,E,"m",Le).call(this);const t=e.target;t.id!==i(this,N,"f").id?i(this,Tt,"f").call(this,t):i(this,E,"m",rt).call(this)}),ut.set(this,e=>{e.preventDefault(),e.stopPropagation()}),pt.set(this,()=>{i(this,E,"m",rt).call(this),i(this,E,"m",Le).call(this)}),i(this,R,"f").info("constructor"),this.uuid=xt(),this.margin={bottom:0,left:0,right:0,top:0},i(this,E,"m",ui).call(this),i(this,E,"m",pi).call(this),i(this,E,"m",fi).call(this),i(this,E,"m",gi).call(this),i(this,E,"m",mi).call(this),i(this,E,"m",vi).call(this),i(this,E,"m",yi).call(this),i(this,E,"m",xi).call(this),i(this,E,"m",bi).call(this),i(this,E,"m",wi).call(this),i(this,E,"m",Ei).call(this)}get internalEvent(){return we.getInstance()}init(e,t,n){i(this,R,"f").info("init",{domElement:e,margin:t,renderingConfiguration:n}),e.appendChild(i(this,se,"f")),i(this,se,"f").appendChild(i(this,X,"f")),i(this,X,"f").appendChild(i(this,Te,"f")),i(this,pe,"f").appendChild(i(this,N,"f")),i(this,X,"f").appendChild(i(this,pe,"f")),i(this,X,"f").appendChild(i(this,ne,"f")),i(this,U,"f").appendChild(i(this,fe,"f")),i(this,U,"f").appendChild(i(this,ge,"f")),i(this,U,"f").appendChild(i(this,me,"f")),i(this,U,"f").classList.add("close"),i(this,X,"f").appendChild(i(this,U,"f")),f(this,ze,!1,"f"),i(this,O,"f").style.display="none",i(this,X,"f").appendChild(i(this,O,"f")),this.margin=t,this.renderingConfiguration=n,i(this,E,"m",Mi).call(this),this.resize()}resize(){i(this,R,"f").info("resize");const e=yt(this.margin.left),t=yt(this.margin.right);i(this,X,"f").style.marginLeft=`${e}px`,i(this,X,"f").style.marginRight=`${t}px`}update(e){var t,n;i(this,R,"f").info("update",{exports:e}),this.jiix=e;const o=(r,s)=>{const d=document.createElement("span");return d.id=`word-${r}${this.uuid}`,s?d.textContent=s.label:d.innerHTML="&nbsp;",i(this,R,"f").debug("update",{span:d}),d};(()=>{var r;if(i(this,R,"f").info("populatePrompter"),i(this,N,"f").innerHTML="",(r=this.jiix)===null||r===void 0?void 0:r.words){const s=this.jiix.words,d=document.createDocumentFragment();s.forEach((l,c)=>{var g,p,m;if(l.label===" "||l.label.includes(`
`))d.appendChild(o(c));else if(c!==s.length-1)d.appendChild(o(c,l));else{i(this,N,"f").appendChild(d),this.lastWord&&(this.lastWord=l);const v=o(c,l);((g=this.lastWord)===null||g===void 0?void 0:g.candidates)!==l.candidates&&((p=this.lastWord)===null||p===void 0?void 0:p.label)!==l.label&&(this.lastWord=l),((m=this.wordToChange)===null||m===void 0?void 0:m.id)===c.toString()?(v.classList.add("modified-word"),this.wordToChange=void 0):v.classList.add("added-word"),i(this,N,"f").appendChild(v),i(this,pe,"f").scrollLeft=v.offsetLeft,i(this,R,"f").debug("update => populatePrompter",{span:v,lastWord:this.lastWord})}})}})(),!((n=(t=this.jiix)===null||t===void 0?void 0:t.words)===null||n===void 0)&&n.length?i(this,ne,"f").style.setProperty("pointer-events","auto"):i(this,ne,"f").style.setProperty("pointer-events","none")}clear(){i(this,R,"f").info("clear"),i(this,N,"f").innerHTML="",i(this,O,"f").innerHTML=""}destroy(){i(this,R,"f").info("destroy"),i(this,E,"m",Ti).call(this),i(this,se,"f").remove()}}se=new WeakMap,X=new WeakMap,pe=new WeakMap,N=new WeakMap,ne=new WeakMap,Te=new WeakMap,O=new WeakMap,U=new WeakMap,fe=new WeakMap,ge=new WeakMap,me=new WeakMap,ze=new WeakMap,R=new WeakMap,Tt=new WeakMap,st=new WeakMap,at=new WeakMap,dt=new WeakMap,ht=new WeakMap,lt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,E=new WeakSet,ui=function(){f(this,se,document.createElement("div"),"f"),i(this,se,"f").id=`smartguide-${this.uuid}`,i(this,se,"f").classList.add("smartguide")},pi=function(){f(this,X,document.createElement("div"),"f"),i(this,X,"f").id=`smartguide-wrapper-${this.uuid}`,i(this,X,"f").classList.add("smartguide-wrapper")},fi=function(){f(this,pe,document.createElement("div"),"f"),i(this,pe,"f").id=`prompter-container-${this.uuid}`,i(this,pe,"f").classList.add("prompter-container")},gi=function(){f(this,N,document.createElement("div"),"f"),i(this,N,"f").id=`prompter-text-${this.uuid}`,i(this,N,"f").classList.add("prompter-text"),i(this,N,"f").setAttribute("touch-action","none")},mi=function(){f(this,ne,document.createElement("div"),"f"),i(this,ne,"f").id=`ellipsis-${this.uuid}`,i(this,ne,"f").classList.add("ellipsis"),i(this,ne,"f").innerHTML="..."},vi=function(){f(this,Te,document.createElement("div"),"f"),i(this,Te,"f").id=`tag-icon-${this.uuid}`,i(this,Te,"f").classList.add("tag-icon"),i(this,Te,"f").innerHTML="&#182;"},yi=function(){f(this,O,document.createElement("div"),"f"),i(this,O,"f").id=`candidates-${this.uuid}`,i(this,O,"f").classList.add("candidates")},xi=function(){f(this,U,document.createElement("div"),"f"),i(this,U,"f").id=`more-menu-${this.uuid}`,i(this,U,"f").classList.add("more-menu")},bi=function(){f(this,fe,document.createElement("button"),"f"),i(this,fe,"f").id=`convert-${this.uuid}`,i(this,fe,"f").classList.add("options-label-button"),i(this,fe,"f").innerHTML="Convert"},wi=function(){f(this,ge,document.createElement("button"),"f"),i(this,ge,"f").id=`copy-${this.uuid}`,i(this,ge,"f").classList.add("options-label-button"),i(this,ge,"f").innerHTML="Copy"},Ei=function(){f(this,me,document.createElement("button"),"f"),i(this,me,"f").id=`delete-${this.uuid}`,i(this,me,"f").classList.add("options-label-button"),i(this,me,"f").innerHTML="Delete"},rt=function(){i(this,O,"f").style.display="none"},Si=function(){i(this,U,"f").classList.add("open"),i(this,U,"f").classList.remove("close"),f(this,ze,!0,"f")},Le=function(){i(this,U,"f").classList.add("close"),i(this,U,"f").classList.remove("open"),f(this,ze,!1,"f")},Ci=function(e){const t=document.documentElement.getAttribute("dir")==="rtl",n=document.createElement("textarea");n.style.fontSize="12pt",n.style.display="absolute",n.style[t?"right":"left"]="-9999px";const o=window.pageYOffset||document.documentElement.scrollTop;return n.style.top=`${o}px`,n.setAttribute("readonly",""),n.value=e,n},ki=function(e){if(navigator.userAgent.match(/ipad|iphone/i)){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t),e.setSelectionRange(0,999999))}else e.select()},Mi=function(){i(this,se,"f").addEventListener("pointerdown",i(this,ut,"f").bind(this)),i(this,ne,"f").addEventListener("pointerdown",i(this,st,"f").bind(this)),i(this,fe,"f").addEventListener("pointerdown",i(this,at,"f").bind(this)),i(this,ge,"f").addEventListener("pointerdown",i(this,dt,"f").bind(this)),i(this,me,"f").addEventListener("pointerdown",i(this,ht,"f").bind(this)),i(this,N,"f").addEventListener("pointerdown",i(this,ct,"f").bind(this)),i(this,O,"f").addEventListener("pointerdown",i(this,lt,"f").bind(this)),document.addEventListener("pointerdown",i(this,pt,"f").bind(this))},Ti=function(){i(this,se,"f").addEventListener("pointerdown",i(this,ut,"f")),i(this,ne,"f").removeEventListener("pointerdown",i(this,st,"f")),i(this,fe,"f").removeEventListener("pointerdown",i(this,at,"f")),i(this,ge,"f").removeEventListener("pointerdown",i(this,dt,"f")),i(this,me,"f").removeEventListener("pointerdown",i(this,ht,"f")),i(this,N,"f").removeEventListener("pointerdown",i(this,ct,"f")),i(this,O,"f").removeEventListener("pointerdown",i(this,lt,"f")),document.removeEventListener("pointerdown",i(this,pt,"f"))},Se=new WeakMap,j=new WeakMap,Pe=new WeakMap,De=new WeakMap,W=new WeakMap,Ve=new WeakMap,Pt=new WeakMap,Dt=new WeakMap,_=new WeakSet,ft=function(e){var t;if(this.logger.info("instantiateBehaviors",{options:e}),!(e!=null&&e.configuration))throw new Error("Configuration required");let n;this.internalEvents.removeAllListeners(),i(this,Pe,"f")&&i(this,Pe,"f").destroy(),n=((t=e.configuration.server)===null||t===void 0?void 0:t.protocol)==="REST"?new Ui(e):new Fi(e),f(this,Pe,Object.assign(n,e.behaviors),"f"),this.logger.debug("instantiateBehaviors",i(this,Pe,"f"))},Li=function(){return u(this,void 0,void 0,function*(){return this.logger.info("initializeBehaviors","start"),f(this,W,new I,"f"),i(this,Se,"f").style.display="initial",i(this,_,"m",gt).call(this),this.behaviors.init(this.wrapperHTML).then(()=>u(this,void 0,void 0,function*(){this.logger.info("initializeBehaviors","then"),this.wrapperHTML.editor=this,i(this,W,"f").resolve(),this.events.emitLoaded()})).catch(e=>{this.logger.error("initializeBehaviors",e),i(this,W,"f").reject(e),i(this,_,"m",Lt).call(this,e)}).finally(()=>(this.logger.debug("initializeBehaviors","finally"),i(this,Se,"f").style.display="none",i(this,W,"f").promise))})},Pi=function(){var e;if((e=i(this,De,"f"))===null||e===void 0||e.destroy(),this.logger.info("initializeSmartGuide",{smartGuide:this.configuration.rendering.smartGuide}),this.configuration.rendering.smartGuide.enable){let t;switch(f(this,De,new Bi,"f"),this.configuration.recognition.type){case"TEXT":t=this.configuration.recognition.text.margin;break;case"MATH":t=this.configuration.recognition.math.margin;break;default:t={top:20,left:10,right:10,bottom:10}}i(this,De,"f").init(this.wrapperHTML,t,this.configuration.rendering)}},gt=function(){i(this,j,"f").style.display="none",i(this,j,"f").innerHTML=""},Lt=function(e){i(this,j,"f").style.display="initial",i(this,j,"f").classList.add("error-msg"),i(this,j,"f").classList.remove("info-msg"),i(this,j,"f").innerText=typeof e=="string"?e:e.message},Di=function(e){i(this,j,"f").style.display="initial",i(this,j,"f").classList.add("info-msg"),i(this,j,"f").classList.remove("error-msg"),i(this,j,"f").innerText=e.message,setTimeout(()=>{i(this,_,"m",gt).call(this)},e.timeout||2500)},Ii=function(){this.internalEvents.addConvertListener(this.convert.bind(this)),this.internalEvents.addClearListener(this.clear.bind(this)),this.internalEvents.addErrorListener(i(this,_,"m",Lt).bind(this)),this.internalEvents.addImportJIIXListener(i(this,_,"m",Ri).bind(this)),this.internalEvents.addExportedListener(i(this,_,"m",Ai).bind(this)),this.internalEvents.addNotifListener(i(this,_,"m",Di).bind(this)),this.internalEvents.addClearMessageListener(i(this,_,"m",gt).bind(this)),this.internalEvents.addContextChangeListener(i(this,Pt,"f").bind(this)),this.internalEvents.addIdleListener(i(this,Dt,"f").bind(this))},Ai=function(e){var t;if(this.logger.info("onExport",{exports:e}),this.configuration.rendering.smartGuide.enable&&e&&e["application/vnd.myscript.jiix"]){const n=e["application/vnd.myscript.jiix"];(t=i(this,De,"f"))===null||t===void 0||t.update(n)}this.events.emitExported(e)},Ri=function(e){this.logger.info("onImportJIIX",{jiix:e}),this.import(new Blob([JSON.stringify(e)],{type:"application/vnd.myscript.jiix"}),"application/vnd.myscript.jiix")},h.AbstractSymbol=Ni,h.CanvasRenderer=$i,h.CanvasRendererShape=_i,h.CanvasRendererStroke=ji,h.CanvasRendererText=Wi,h.Configuration=wt,h.DefaultConfiguration=ke,h.DefaultConvertionConfiguration=ti,h.DefaultDebugConfiguration=Zt,h.DefaultDiagramConfiguration=Ut,h.DefaultDiagramConvertConfiguration=Gt,h.DefaultEraserConfiguration=$e,h.DefaultExportConfiguration=Bt,h.DefaultGrabberConfiguration=Ht,h.DefaultGuidesConfiguration=ni,h.DefaultJiixConfiguration=Ft,h.DefaultListenerConfiguration=$t,h.DefaultLoggerConfiguration=Et,h.DefaultMarginConfiguration=bt,h.DefaultMathConfiguration=Jt,h.DefaultMathUndoRedoConfiguration=qt,h.DefaultPenStyle=Ge,h.DefaultRawContentConfiguration=Yt,h.DefaultRawContentRecognitionConfiguration=Xt,h.DefaultRecognitionConfiguration=ii,h.DefaultRecognitionRendererConfiguration=Kt,h.DefaultRenderingConfiguration=ri,h.DefaultServerConfiguration=si,h.DefaultSmartGuidesConfiguration=oi,h.DefaultSolverConfiguration=Vt,h.DefaultTextConfiguration=ei,h.DefaultTextGuidesConfiguration=Qt,h.DefaultTheme=li,h.DefaultTriggerConfiguration=ai,h.DefaultUndoRedoConfiguration=di,h.DeferredPromise=I,h.Editor=class{constructor(e,t,n="ms-editor"){_.add(this),this.logger=T.getLogger("EDITOR"),Se.set(this,void 0),j.set(this,void 0),Pe.set(this,void 0),De.set(this,void 0),W.set(this,void 0),Ve.set(this,void 0),Pt.set(this,r=>{this.events.emitChanged(r)}),Dt.set(this,r=>{this.events.emitIdle(r)}),f(this,W,new I,"f"),this.loggerConfiguration=K({},t.logger,Et),this.logger.info("constructor",{wrapperHTML:e,options:t,globalClassCss:n}),this.wrapperHTML=e,this.wrapperHTML.classList.add(n),this.wrapperHTML.classList.add("draw"),this.events.setElement(this.wrapperHTML);const o=document.createElement("style");o.appendChild(document.createTextNode(`.ms-editor{color:#1a9fff;font-family:sans-serif;position:relative;z-index:10}.ms-editor.draw{cursor:url("data:image/svg+xml;charset=utf-8,%3Csvg width='25' height='25' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg filter='url(%23a)'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M5.437 16.033c-.09.394-.167.723-.203.989-.037.27-.045.551.061.818a1.5 1.5 0 0 0 .836.836c.267.106.547.098.818.061.266-.036.595-.112.989-.203l1.23-.284.039-.009c.296-.068.5-.115.695-.196.172-.072.336-.163.488-.27.171-.123.32-.271.535-.486l.028-.028 8.982-8.982c.285-.285.52-.52.695-.727.183-.215.33-.432.415-.691.13-.402.13-.835 0-1.236-.085-.26-.232-.477-.415-.692-.176-.207-.41-.442-.695-.726l-.17-.171a13.38 13.38 0 0 0-.727-.695c-.215-.183-.433-.33-.692-.415a2 2 0 0 0-1.236 0c-.259.084-.476.232-.691.415-.207.176-.442.41-.727.695L6.71 13.018l-.028.028c-.215.215-.363.364-.485.535a2.499 2.499 0 0 0-.27.488c-.082.194-.129.4-.197.695l-.009.039-.284 1.23Z' fill='%23fff'/%3E%3C/g%3E%3Cpath d='m19.425 4.404.142.142c.594.594.89.89 1.002 1.233a1.5 1.5 0 0 1 0 .927c-.111.343-.408.64-1.002 1.234L18.436 9.07l-7.837 7.836c-.241.242-.362.363-.499.46a1.997 1.997 0 0 1-.39.216c-.155.065-.321.103-.654.18l-1.207.278c-.828.191-1.241.287-1.532.17a1 1 0 0 1-.557-.557c-.117-.29-.021-.704.17-1.531l.278-1.208c.077-.333.116-.499.18-.654.057-.138.13-.268.216-.39.098-.137.218-.258.46-.5L14.9 5.537l1.131-1.132c.594-.594.891-.89 1.234-1.002a1.5 1.5 0 0 1 .927 0c.342.111.64.408 1.233 1.002Z' fill='%23fff'/%3E%3Cpath d='m18.436 9.071 1.13-1.131c.595-.594.892-.891 1.003-1.234a1.5 1.5 0 0 0 0-.927c-.111-.342-.408-.64-1.002-1.233l-.142-.142c-.594-.594-.89-.89-1.233-1.002a1.5 1.5 0 0 0-.927 0c-.343.111-.64.408-1.234 1.002L14.9 5.536m3.536 3.535-7.837 7.836c-.241.242-.362.363-.499.46a1.997 1.997 0 0 1-.39.216c-.155.065-.321.103-.654.18l-1.207.278c-.828.191-1.241.287-1.532.17a1 1 0 0 1-.557-.557c-.117-.29-.021-.704.17-1.531l.278-1.208c.077-.333.116-.499.18-.654.057-.138.13-.268.216-.39.098-.137.218-.258.46-.5L14.9 5.537m3.536 3.535L14.9 5.536' stroke='%23000' stroke-linejoin='round'/%3E%3Cdefs%3E%3Cfilter id='a' x='.506' y='0' width='24.465' height='24.465' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeFlood flood-opacity='0' result='BackgroundImageFix'/%3E%3CfeColorMatrix in='SourceAlpha' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0'/%3E%3CfeOffset dy='1'/%3E%3CfeGaussianBlur stdDeviation='1.5'/%3E%3CfeColorMatrix values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.35 0'/%3E%3CfeBlend in2='BackgroundImageFix' result='effect1_dropShadow'/%3E%3CfeBlend in='SourceGraphic' in2='effect1_dropShadow' result='shape'/%3E%3C/filter%3E%3C/defs%3E%3C/svg%3E") 5.5 19.5,crosshair}.ms-editor.draw.shape{cursor:crosshair}.ms-editor.erase{cursor:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEsSURBVDiNrdO7SgNBFMbx/3fmCbQ1tunDIayFBvFSKxbxBfSdBPEBtLIWb3Ebl4R9AQWLkE70CWbHZl1Eg2iSr5vL+c1hhhFTMhwOdyX1gQ2gVU+PgTyldNHtdq+/1+jroCiKtpmdSupNO6ApkgZmdtzpdJ5+QGVZ9qqqugSWfkO+5F3SnrvnDVQURTuE8PgP5DNvkjJ3fzaAEMLJDAjAclVVZwCqL/ZqBqSJme2YpMN5EIAYY9+A9XkhST0DVuaFgJYtAAGoDJgsAJoYkM+rSHqwlNL5Ajq6EMBoNLoBtmbsZuDumwYQYzwCXmdw3oAjAAPIsuxF0kG98GdE0r67PzcQgLvnIYQ14P4PyF39WZuH0rRdZVluxxj7kjaA1Xp6nFLKzezc3W+/13wAItdV6XjME1AAAAAASUVORK5CYII=") 10 10,auto}.ms-editor.select{cursor:default}.ms-editor.select [type=stroke]{cursor:pointer}.ms-editor canvas,.ms-editor svg{height:100%;left:0;position:absolute;top:0;width:100%;z-index:20}.ms-editor canvas.ms-rendering-canvas{background-image:linear-gradient(90deg,#f5f6f7 1px,transparent 0),linear-gradient(180deg,#f5f6f7 1px,transparent 0);background-size:18px 18px;pointer-events:none;z-index:9}.ms-editor .loader{-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite;border:16px solid #f5f6f7;border-radius:50%;border-top-color:#1a9fff;height:120px;left:calc(50% - 60px);position:absolute;top:calc(50% - 60px);width:120px;z-index:30}.ms-editor .message{word-wrap:break-word;font-size:16px;left:calc(50% - 150px);max-height:25%;min-height:200px;position:absolute;text-align:center;top:calc(50% - 100px);width:300px;z-index:25}.ms-editor .message.error-msg:before{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgNzYuNSA2MTIgNDU5IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWluWU1pbiBtZWV0Ij48cGF0aCBmaWxsPSIjMUE5RkZGIiBkPSJNNDk0LjcgMjI5LjVjLTE3Ljg1MS04Ni43LTk0LjM1MS0xNTMtMTg4LjctMTUzLTM4LjI1IDAtNzMuOTUgMTAuMi0xMDIgMzAuNmwzOC4yNSAzOC4yNWMxNy44NS0xMi43NSA0MC44LTE3Ljg1IDYzLjc1LTE3Ljg1IDc2LjUgMCAxNDAuMjUgNjMuNzUgMTQwLjI1IDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSAwIDc2LjUgMzMuMTUgNzYuNSA3Ni41IDAgMjguMDUtMTUuMyA1My41NS00MC44IDY2LjNsMzguMjUgMzguMjVDNTkxLjYgNDM4LjYgNjEyIDQwMC4zNSA2MTIgMzU3YzAtNjYuMy01My41NS0xMjIuNC0xMTcuMy0xMjcuNXpNNzYuNSAxMDkuNjVsNzEuNCA2OC44NUM2Ni4zIDE4My42IDAgMjQ5LjkgMCAzMzEuNWMwIDg0LjE1IDY4Ljg1IDE1MyAxNTMgMTUzaDI5OC4zNWw1MSA1MSAzMy4xNS0zMy4xNUwxMDkuNjUgNzYuNSA3Ni41IDEwOS42NXpNMTk2LjM1IDIyOS41bDIwNCAyMDRIMTUzYy01Ni4xIDAtMTAyLTQ1LjktMTAyLTEwMnM0NS45LTEwMiAxMDItMTAyaDQzLjM1eiIvPjwvc3ZnPg==")}.ms-editor .message.info-msg:before{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMUE5RkZGIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiLz48cGF0aCBkPSJNMTIgMTZ2LTRNMTIgOGguMDEiLz48L3N2Zz4=");background-size:100% 100%;content:"";display:block;height:25px;margin:auto;padding-bottom:10px;width:25px}.ms-editor .smartguide{box-shadow:2px 2px 12px #bdbdbd;cursor:default;font-size:16px;left:0;line-height:48px;padding-bottom:12px;padding-top:12px;position:absolute;top:0;width:100%;z-index:40}.ms-editor .smartguide .smartguide-wrapper{border-bottom:1px solid #959da6;display:flex}.ms-editor .smartguide .tag-icon{border-left:1px solid #959da6;border-right:1px solid #959da6;border-top:1px solid #959da6;font-size:large;height:100%;line-height:48px;padding:0 18px;z-index:31}.ms-editor .smartguide .ellipsis,.ms-editor .smartguide .tag-icon{background-color:hsla(0,0%,100%,.9);color:#959da6;font-weight:700;height:48px;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:48px}.ms-editor .smartguide .ellipsis{-webkit-tap-highlight-color:transparent;cursor:pointer;font-size:x-large;line-height:38px;padding:0 8px}.ms-editor .smartguide .ellipsis:active{background-color:#e0e0e0}.ms-editor .smartguide .prompter-container{-webkit-tap-highlight-color:transparent;background-color:hsla(0,0%,100%,.9);color:#bfbfbf;display:block;height:48px;line-height:48px;overflow:hidden;text-align:left;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;width:calc(100% - 96px)}.ms-editor .smartguide .prompter-container>div>span{cursor:pointer;display:inline-block}.ms-editor .smartguide .prompter-container .prompter-text{margin-left:12px}.ms-editor .smartguide .prompter-container .prompter-text .added-word{animation:word-added .1s linear,color-input 3s ease-in-out}.ms-editor .smartguide .prompter-container .prompter-text .modified-word{animation:word-modified .1s linear,color-input 3s ease-in-out}.ms-editor .smartguide .candidates{-webkit-tap-highlight-color:transparent;background-color:#f5f5f5;border-radius:3px;box-shadow:2px 2px 12px #bdbdbd,-2px 2px 12px #bdbdbd;color:#000;flex-direction:column;line-height:30px;position:absolute;text-align:center;z-index:100}.ms-editor .smartguide .candidates>span{cursor:pointer;padding:2px 20px}.ms-editor .smartguide .candidates>span:hover{background-color:#eee}.ms-editor .smartguide .candidates>span:active{background-color:#e0e0e0}.ms-editor .smartguide .candidates .selected-word{background-color:#e0e0e0;font-weight:700}.ms-editor .smartguide .more-menu{background-color:#f5f5f5;border-radius:3px;bottom:0;box-shadow:2px 2px 12px #bdbdbd;display:flex;flex-direction:column;line-height:30px;margin-right:12px;overflow:hidden;position:absolute;right:0;transform:translateY(100%);transition:max-height 1s ease-out,opacity 1s,visibility .5s linear;z-index:100}.ms-editor .smartguide .more-menu.open{max-height:500px;opacity:1;visibility:visible}.ms-editor .smartguide .more-menu.close{max-height:0;opacity:0;visibility:hidden}.ms-editor .smartguide .more-menu .options-label-button{-webkit-tap-highlight-color:transparent;background:transparent;border:none;box-sizing:border-box;color:#000;cursor:pointer;font-size:16px;height:40px;margin:0;outline:none;padding:0 24px}.ms-editor .smartguide .more-menu .options-label-button:hover{background-color:#eee}.ms-editor .smartguide .more-menu .options-label-button:active{background-color:#e0e0e0}.ms-editor .ps__rail-x{top:32px!important}.ms-editor #stroke-panel{word-wrap:break-word;background-color:#fff;border:2px solid #000;bottom:10px;cursor:copy;left:10px;max-height:100px;overflow:auto;padding:5px;position:fixed;right:10px;z-index:999}.ms-editor hr.separator.horizontal{border:none;border-top:1px solid #d3d3d3;margin:5px 0;max-height:1px;max-width:100%;min-height:1px;min-width:100%}.ms-editor hr.separator.vertical{border:none;border-left:1px solid #d3d3d3;margin:0 5px;max-height:100%;max-width:1px;min-height:100%;min-width:1px}.ms-editor .stroke-menu{background-color:#fff;border-radius:12px;box-shadow:2px 2px 10px rgba(0,0,0,.25),-2px -2px 10px rgba(0,0,0,.25);cursor:pointer;cursor:auto;display:flex;gap:2px;padding:5px;position:absolute;width:auto;z-index:999}.ms-editor .stroke-menu-button{background:#f6f5f4;background-color:#fff;border:none;border-radius:4px;cursor:pointer;display:block;font-size:inherit;height:32px;margin:auto;position:relative;width:32px}.ms-editor .stroke-menu-button:hover{background-color:hsla(0,0%,44%,.1)}.ms-editor .stroke-menu-button .tooltip{background-color:#000;bottom:100%;color:#fff}.ms-editor .stroke-menu-button .tooltip,.ms-editor output.tooltip{border-radius:5px;display:none;font-weight:700;left:50%;padding:5px;position:absolute;transform:translate(-50%,-50%);white-space:nowrap;width:auto}.ms-editor output.tooltip{background-color:#fff;box-shadow:0 2px 5px 0 rgba(0,0,0,.225);color:#000;top:0}.ms-editor input:focus+output.tooltip,.ms-editor input:focus-visible+output.tooltip,.ms-editor input:hover+output.tooltip{display:block}.ms-editor .stroke-menu-button:focus .tooltip,.ms-editor .stroke-menu-button:focus-visible .tooltip,.ms-editor .stroke-menu-button:hover .tooltip{display:block}.ms-editor .stroke-menu-button svg{display:block;position:relative}.ms-editor .stroke-sub-menu{background-color:#fff;border-radius:12px;box-shadow:0 2px 5px 0 rgba(0,0,0,.225);display:none;padding:5px;position:absolute;top:100%;transform:translate(calc(-50% + 16px),12px);width:190px}.ms-editor .stroke-sub-menu.active{display:block}.ms-editor .stroke-sub-menu label{color:#717171;font-weight:700;padding:5px}.ms-editor .stroke-menu-button-color{background-color:rgba(0,0,0,.05);display:flex}.ms-editor .stroke-menu .menu-list{display:flex;flex-wrap:wrap;gap:5px;list-style:none;margin:0;padding:0}.ms-editor .removed-stroke{opacity:0;transition:opacity .1s ease-in-out}.ms-editor .added-stroke{animation:opacity-appear .2s}@keyframes color-input{0%{color:#000}to{color:#bfbfbf}}@keyframes word-added{0%{transform:translate(5px)}to{transform:none}}@keyframes word-modified{0%{transform:translateY(5px)}to{transform:none}}@keyframes opacity-appear{0%{opacity:0}to{opacity:1}}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}`)),this.wrapperHTML.appendChild(o),f(this,Se,document.createElement("div"),"f"),i(this,Se,"f").classList.add("loader"),i(this,Se,"f").style.display="none",this.wrapperHTML.appendChild(i(this,Se,"f")),f(this,j,document.createElement("div"),"f"),i(this,j,"f").classList.add("message"),i(this,j,"f").style.display="none",this.wrapperHTML.appendChild(i(this,j,"f")),i(this,_,"m",ft).call(this,t)}get loggerConfiguration(){return i(this,Ve,"f")}set loggerConfiguration(e){f(this,Ve,Object.assign({},Et,e),"f"),T.setLoggerLevel(i(this,Ve,"f"))}get initializationPromise(){return i(this,W,"f").promise}get model(){return this.behaviors.model}get behaviors(){return i(this,Pe,"f")}get configuration(){return this.behaviors.configuration}set configuration(e){this.logger.info("set configuration",{configuration:e}),i(this,_,"m",ft).call(this,{configuration:e}),this.initialize()}get intention(){return this.behaviors.intention}set intention(e){this.behaviors.intention=e,this.behaviors.intention==="erase"?(this.wrapperHTML.classList.remove("draw"),this.wrapperHTML.classList.add("erase"),this.wrapperHTML.classList.remove("select")):(this.wrapperHTML.classList.add("draw"),this.wrapperHTML.classList.remove("erase"),this.wrapperHTML.classList.remove("select")),this.logger.debug("set intention",this.wrapperHTML)}get events(){return St.getInstance()}get internalEvents(){return we.getInstance()}get context(){return this.behaviors.context}get grabber(){return this.behaviors.grabber}get currentPenStyle(){return this.behaviors.currentPenStyle}get penStyle(){return this.behaviors.penStyle}set penStyle(e){this.logger.info("set penStyle",{ps:e}),this.behaviors.setPenStyle(e)}get theme(){return this.behaviors.theme}set theme(e){this.logger.info("set theme",{t:e}),this.behaviors.setTheme(e)}get penStyleClasses(){return this.behaviors.penStyleClasses}set penStyleClasses(e){this.logger.info("set penStyleClasses",{psc:e}),this.behaviors.setPenStyleClasses(e)}get gestures(){return this.configuration.recognition.gesture.enable}set gestures(e){this.configuration.recognition.gesture.enable=e,i(this,_,"m",ft).call(this,{configuration:this.configuration}),this.initialize()}initialize(){return u(this,void 0,void 0,function*(){this.logger.info("initialize"),yield i(this,_,"m",Li).call(this),i(this,_,"m",Pi).call(this),i(this,_,"m",Ii).call(this)})}waitForIdle(){return u(this,void 0,void 0,function*(){if(this.behaviors.waitForIdle)return this.behaviors.waitForIdle()})}undo(){return u(this,void 0,void 0,function*(){return this.logger.info("undo"),yield i(this,W,"f").promise,yield this.behaviors.undo(),this.logger.debug("undo",this.model),this.model})}redo(){return u(this,void 0,void 0,function*(){return this.logger.info("redo"),yield i(this,W,"f").promise,yield this.behaviors.redo(),this.logger.debug("redo",this.model),this.model})}clear(){return u(this,void 0,void 0,function*(){return this.logger.info("clear"),yield i(this,W,"f").promise,yield this.behaviors.clear(),this.events.emitCleared(this.model),this.logger.debug("clear",this.model),this.model})}resize(){var e;return u(this,void 0,void 0,function*(){this.logger.info("resize"),yield i(this,W,"f").promise,this.configuration.rendering.smartGuide.enable&&((e=i(this,De,"f"))===null||e===void 0||e.resize());const t=window.getComputedStyle(this.wrapperHTML),n=Math.max(parseInt(t.height.replace("px","")),this.configuration.rendering.minHeight),o=Math.max(parseInt(t.width.replace("px","")),this.configuration.rendering.minWidth);return yield this.behaviors.resize(n,o),this.logger.debug("resize",this.model),this.model})}export(e){return u(this,void 0,void 0,function*(){return this.logger.info("export",{mimeTypes:e}),yield i(this,W,"f").promise,yield this.behaviors.export(e),this.logger.debug("export",this.model),this.model})}convert(e){return u(this,void 0,void 0,function*(){return this.logger.info("export",{params:e}),yield i(this,W,"f").promise,yield this.behaviors.convert(e==null?void 0:e.conversionState,e==null?void 0:e.mimeTypes),this.events.emitConverted(this.model.converts),this.logger.debug("convert",this.model),this.model})}import(e,t){return u(this,void 0,void 0,function*(){if(this.logger.info("import",{data:e,mimeType:t}),yield i(this,W,"f").promise,this.behaviors.import){let n;return n=e instanceof Blob?e:typeof e=="string"?new Blob([e]):new Blob([JSON.stringify(e)]),yield this.behaviors.import(n,t),this.events.emitImported(this.model.exports),this.logger.debug("import",this.model),this.model}return Promise.reject("Import impossible, behaviors has no import function")})}importPointEvents(e){return u(this,void 0,void 0,function*(){return this.logger.info("importPointEvents",{strokes:e}),yield i(this,W,"f").promise,yield this.behaviors.importPointEvents(e),this.events.emitImported(this.model.exports),this.logger.debug("importPointEvents",this.model),this.model})}},h.Error=L,h.EventType=ve,h.InternalEvent=we,h.InternalEventType=k,h.Logger=jt,h.LoggerManager=T,h.Model=qe,h.PointerEventGrabber=Ct,h.PublicEvent=St,h.RestBehaviors=Ui,h.RestRecognizer=Oi,h.SVGStroker=Hi,h.SmartGuide=Bi,h.Stroke=Ie,h.StyleHelper=tt,h.StyleManager=It,h.UndoRedoContext=At,h.UndoRedoManager=Rt,h.WSBehaviors=Fi,h.WSRecognizer=zi,h.WSSVGRenderer=Gi,h.computeAngleAxeRadian=F,h.computeDistance=We,h.computeDistanceBetweenPointAndSegment=function(e,t){return We(e,Wt(e,t))},h.computeHmac=vt,h.computeLinksPointers=B,h.computeMiddlePointer=de,h.computeNearestPointOnSegment=Wt,h.convertMillimeterToPixel=yt,h.convertPartialStrokesToStrokes=function(e){const t=[],n=[];if(e.forEach((o,r)=>{var s,d;let l=!0;const c=new Ie(o.style||Ge,o.pointerId||1);if(o.id&&(c.id=o.id),!(!((s=o.pointers)===null||s===void 0)&&s.length))return t.push(`stroke ${r+1} has not pointers`),void(l=!1);(d=o.pointers)===null||d===void 0||d.forEach((g,p)=>{if(!g)return t.push(`stroke ${r+1} has no pointer at ${p}`),void(l=!1);const m={p:g.p||1,t:g.t||p,x:0,y:0};return(g==null?void 0:g.x)==null||(g==null?void 0:g.x)==null?(t.push(`stroke ${r+1} has no x at pointer at ${p}`),void(l=!1)):(m.x=g.x,(g==null?void 0:g.y)==null||(g==null?void 0:g.y)==null?(t.push(`stroke ${r+1} has no y at pointer at ${p}`),void(l=!1)):(m.y=g.y,void(l&&c.pointers.push(m))))}),l&&n.push(c)}),t.length)throw new Error(t.join(`
`));return n},h.convertPixelToMillimeter=function(e){return e/96*25.4},h.createPointsOnSegment=function(e,t,n=1){const o=[],r=We(e,t);let s=n;for(;s<r;){const d={x:e.x+s*(t.x-e.x)/r,y:e.y+s*(t.y-e.y)/r};o.push(d),s+=n}return o},h.createUUID=xt,h.getAvailableFontList=function(e){var t,n,o;return u(this,void 0,void 0,function*(){if(!(!((t=e==null?void 0:e.server)===null||t===void 0)&&t.scheme)&&!(!((n=e==null?void 0:e.server)===null||n===void 0)&&n.host))return Promise.reject("Failed to get fonts: configuration.server.scheme & configuration.server.host are required!");if(!(!((o=e==null?void 0:e.recognition)===null||o===void 0)&&o.lang))return Promise.reject("Failed to get fonts: configuration.recognition.lang is required!");const r=e.server,s=yield fetch(`${r.scheme}://${r.host}/api/v4.0/iink/font/google/language/`+e.recognition.lang),{result:d}=yield s.json();return d.sort()})},h.getAvailableLanguageList=function(e){var t,n;return u(this,void 0,void 0,function*(){if(((t=e==null?void 0:e.server)===null||t===void 0?void 0:t.scheme)&&((n=e==null?void 0:e.server)===null||n===void 0?void 0:n.host)){const o=e.server;return(yield fetch(`${o.scheme}://${o.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Failed to get languages: configuration.server.scheme & configuration.server.host are required!")})},h.isBetween=function(e,t,n){return e>=t&&e<=n},h.isVersionSuperiorOrEqual=Ye,h.mergeDeep=K,h.scalaire=mt})})(Vi,Vi.exports);const Ot=document.querySelector(".results"),zt=document.querySelector(".operation-display");let Ce="",Nt="simple";const Qi=D=>{Ce+=D,zt.innerHTML=`${Ce}`},qi=()=>{Ce="",zt.innerHTML="",Ot.innerHTML=""},Ji=()=>{Ce=Ce.slice(0,-1),zt.innerHTML=`${Ce}`},_t=D=>{const $=D.target.value;Qi($)},Xi=()=>{try{const D=math.evaluate(`${Ce}`);Ot.innerHTML=`${D}`,Ce=`${D}`}catch{Ot.innerHTML="Error"}},Yi=()=>{Nt==="simple"?(Nt="hand-note",document.querySelector("#secondSuper").classList.toggle("hide"),document.querySelector("main").classList.toggle("hide"),document.querySelector(".screen").classList.toggle("hide"),document.querySelector("#editor").style.display="block",document.querySelector(".hand-buttons").classList.toggle("hide"),document.querySelectorAll("li").forEach(D=>D.classList.toggle("hide"))):(Nt="simple",document.querySelector("#secondSuper").classList.toggle("hide"),document.querySelector("main").classList.toggle("hide"),document.querySelector(".screen").classList.toggle("hide"),document.querySelector("#editor").style.display="none",document.querySelector(".hand-buttons").classList.toggle("hide"),document.querySelectorAll("li").forEach(D=>D.classList.toggle("hide")))};document.addEventListener("keydown",D=>{const $=D.key;(!isNaN($)||["+","-","*","/"].includes($))&&_t({target:{value:$}}),$==="Enter"&&Xi(),$==="Backspace"&&Ji(),($==="c"||$==="C")&&qi()});document.querySelector(".numbers-container").addEventListener("click",D=>{D.target.classList.contains("number")&&_t(D)});document.querySelectorAll(".operator").forEach(D=>{D.addEventListener("click",_t)});document.querySelector("#clear").addEventListener("click",qi);document.querySelector(".equal").addEventListener("click",Xi);document.querySelector("#delete").addEventListener("click",Ji);document.querySelector("#super").addEventListener("click",Yi);document.querySelector("#secondSuper").addEventListener("click",Yi);const en=document.getElementById("editor"),Je=new iink.Editor(en,{configuration:{server:{protocal:"REST",applicationKey:"9b3f6f32-9b70-4dbd-9e46-e4e7eda793c7",hmacKey:"c69d1492-d59e-44b0-bfa9-a83fa5a3733c"},recognition:{type:"MATH"}}});Je.initialize();document.querySelector("#convert").addEventListener("click",()=>{Je.convert()});document.querySelector("#clearCanvas").addEventListener("click",async()=>{Je.clear()});document.querySelector("#undo").addEventListener("click",()=>{Je.undo()});document.querySelector("#redo").addEventListener("click",()=>{Je.redo()});
